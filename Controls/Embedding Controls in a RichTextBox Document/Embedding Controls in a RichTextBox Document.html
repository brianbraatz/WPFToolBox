<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Petzold Book Blog - Embedding Controls in a RichTextBox Document</title></head><body style="text-align: center;">
    <div style="width: 40em; text-align: left;"><p style="text-align: center;"><b><font size="+4">P</font><font size="+3">ETZOLD</font>&nbsp;<font size="+4">B</font><font size="+3">OOK</font>&nbsp;<font size="+4">B</font><font size="+3">LOG</font></b></p><h4 style="text-align: center;">Charles Petzold on writing books, reading books, and exercising the internal <a title="Universal Turing Machine">UTM</a></h4><hr><table width="100%"><tbody><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/blog.xml">Recent Entries</a></td><td width="33%"></td></tr><tr><td width="33%"><a href="http://www.charlespetzold.com/blog/2006/01/160909.html">&lt; Previous</a></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/toc.html">Browse the Archives</a></td><td align="right" width="33%"><a href="http://www.charlespetzold.com/blog/2006/01/180922.html">Next &gt;</a></td></tr><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/rss.xml">Subscribe to the RSS Feed</a></td><td width="33%"></td></tr></tbody></table><hr><a href="http://www.charlespetzold.com/blog/2006/01/180334.html" style="color: rgb(0, 0, 128); text-decoration: none;"><h2>Embedding Controls in a RichTextBox Document</h2></a><p style="text-align: right;">January 18, 2006<br>New York City</p><p>
In the world of WPF text elements, a <i>TextBlock</i> is basically a collection of <i>Inline</i> objects, which include things like <i>Run</i>, <i>Span</i>, <i>Italic</i>, and <i>Bold</i>. 
</p>
<p>
The <i>TextFlow</i> and <i>FlowDocument</i> elements are basically collections of <i>Block</i> objects, which include <i>Section</i>, <i>List</i>, <i>Table</i>, and <i>Paragraph</i>. (Of course, <i>Paragraph</i> is a collection of <i>Inline</i> objects.)
</p>
<p>
Among the descendents of <i>Block</i> is <i>BlockUIContainer</i> and among the descendents of <i>Inline</i> is <i>InlineUIContainer</i>. These two classes are very similar: They both define a <i>Child</i> element of type <i>UIElement</i>. In theory, these two classes allow you to insert any WPF element into text, either inline or as its own paragraph. 
</p>
<p>
The WPF version of <i>RichTextBox</i> is basically a <i>FlowDocument</i> editor, which means that (in theory, anyway) you can insert any WPF element into a <i>RichTextBox</i> document.  Not only things like <i>Image</i> and <i>Polyline</i> but also anything that derives from <i>Control</i>, and any class that you define based on <i>UIElement</i> or (more likely) <i>FrameworkElement</i> or <i>Control</i>. The user can interact with these elements, and when you eventually get the <i>FlowDocument</i> object out of the <i>RichTextBox</i>, it will include an XAML representation of these embedded elements.
</p>
<p>
Alas, I couldn't get it to work. I could <i>see</i> the embedded elements in the <i>RichTextBox</i>
but they wouldn't interact with me. It looked as if the elements were
disabled, but explicitly enabling them didn't seem to help. </p>
<p>
Fortunately, I knew that at least one programmer got this working at one time, because I saw <a href="http://www.wiredprairie.us/journal/2005/11/wpf_avalon_is_so_cool.html">some XAML and a screen shot on Wired Prairie</a>. Thank you, Aaron, for helping me to get this to work. The secret is that the <i>FlowDocument</i>
must be explicitly enabled. Here's some XAML I got working under the
December CTP. (Although the tags aren't required, the first <i>Button</i> gets wrapped in an <i>InlineUIContainer</i> and the second in a <i>BlockUIContainer</i>.)
</p>
<ul style="font-family: monospace; font-weight: bold;">
&lt;StackPanel&nbsp;xmlns="http://schemas.microsoft.com/winfx/avalon/2005"&gt;<br>&nbsp;&nbsp;&lt;RichTextBox&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;FlowDocument&nbsp;IsEnabled="true"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Paragraph&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;some&nbsp;text&nbsp;before&nbsp;the&nbsp;inline&nbsp;button.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Button&nbsp;Margin="10,0,10,0"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hello,&nbsp;Embedded&nbsp;Inline&nbsp;Button<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Button&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;And&nbsp;this&nbsp;is&nbsp;some&nbsp;text&nbsp;after&nbsp;the&nbsp;inline&nbsp;button.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Paragraph&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Paragraph&nbsp;TextAlignment="Center"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Button&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hello,&nbsp;Embedded&nbsp;Block&nbsp;Button<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Button&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Paragraph&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Paragraph&nbsp;TextAlignment="Right"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;And&nbsp;this&nbsp;is&nbsp;some&nbsp;text&nbsp;after&nbsp;the&nbsp;block&nbsp;button<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Paragraph&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FlowDocument&gt;<br>&nbsp;&nbsp;&lt;/RichTextBox&gt;<br>&lt;/StackPanel&gt;<br>
</ul>
<p>
A <i>FlowDocument</i> begins life with its <i>IsEnabled</i> flag set to <i>true</i>. However, when you pass a <i>FlowDocument</i> object to the <i>RichTextBox</i> constructor, or when you assign the <i>Document</i> property of a <i>RichTextBox</i> to a <i>FlowDocument</i> object, or when you let <i>RichTextBox</i> create its own <i>FlowDocument</i> object, the control apparently disables the <i>FlowDocument</i>. I don't know why. 
</p>
<div id="comments"><hr><table width="100%"><tbody><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/blog.xml">Recent Entries</a></td><td width="33%"></td></tr><tr><td width="33%"><a href="http://www.charlespetzold.com/blog/2006/01/160909.html">&lt; Previous</a></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/toc.html">Browse the Archives</a></td><td align="right" width="33%"><a href="http://www.charlespetzold.com/blog/2006/01/180922.html">Next &gt;</a></td></tr><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/rss.xml">Subscribe to the RSS Feed</a></td><td width="33%"></td></tr></tbody></table><hr><p>(c) Copyright Charles Petzold<br><a href="http://www.charlespetzold.com/">www.charlespetzold.com</a></p></div>
<a href="http://www.charlespetzold.com/">  </a></div></body></html>