var browserAbstractionLayer={InitializeBrowserTweaks:function(){if(navigator.userAgent.indexOf("Firefox")!=-1){function a(a,h,g){var d=new XPathEvaluator,e=a.createNSResolver(a.documentElement),f=d.evaluate(h,g,e,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),b=[],c;while((c=f.iterateNext())!=null)b.push(c);return b}XMLDocument.prototype.selectNodes=function(b){return a(this,b,this.documentElement)};Element.prototype.selectNodes=function(b){return a(this.ownerDocument,b,this)};XMLDocument.prototype.selectSingleNode=function(b){var a=this.selectNodes(b);return a.length>0?a[0]:null};Element.prototype.selectSingleNode=function(b){var a=this.selectNodes(b);return a.length>0?a[0]:null};Element.prototype.__defineGetter__("xml",function(){var a=new XMLSerializer;return a.serializeToString(this)});Element.prototype.__defineGetter__("text",function(){return this.textContent});Element.prototype.__defineSetter__("text",function(a){this.textContent=a});XMLDocument.prototype.__defineGetter__("text",function(){return this.childNodes[0].textContent});XMLDocument.prototype.__defineGetter__("xml",function(){var a=new XMLSerializer;return a.serializeToString(this)})}},CreateXmlDocumentFromString:function(b){var a;if(navigator.userAgent.indexOf("Firefox")!=-1){var c=new DOMParser;a=c.parseFromString(b,"text/xml");browserAbstractionLayer.RemoveWhitespaceFromXmlElement(a.documentElement)}else{a=new ActiveXObject("Msxml2.DOMDocument.3.0");a.loadXML(b)}return a},RemoveWhitespaceFromXmlElement:function(b){var a=b.firstChild;while(a!=null){var c=a.nextSibling;if(a.nodeType==1)browserAbstractionLayer.RemoveWhitespaceFromXmlElement(a);else if(a.nodeType==3)if(!(new RegExp("[^\t\n\r ]")).test(a.data))b.removeChild(a);a=c}}};function stringIfNull(c,b){var a="";if(c)a=c.text;else if(b)a=b;return a}browserAbstractionLayer.InitializeBrowserTweaks();environment=new EnvironmentComponent;environmentHasContent=false;environmentOutputHasBeenCalled=false;callContext=[];blockMetadata={};function EnvironmentComponent(){}EnvironmentComponent.ScriptCounter=0;EnvironmentComponent.prototype.designTime=false;EnvironmentComponent.prototype.previewTime=false;function Header(b,a){this.Key=b;this.Value=a}EnvironmentComponent.prototype.getBlockVersion=function(b){var a=blockMetadata[b];if(a&&a.version)return a.version;else return "unknown"};EnvironmentComponent.prototype.getPreferredTextColor=function(){var a="black";if(document.body.style&&document.body.style.color){a=document.body.style.color;if(a.startsWith("rgb(")){a=a.substring(4);var e=a.split(", "),d=e[0],c=e[1],b=e[2].substring(0,e[2].length-1);d=(new Number(d)).toString(16);c=(new Number(c)).toString(16);b=(new Number(b)).toString(16);if(d.length==1)d="0"+d;if(c.length==1)c="0"+c;if(b.length==1)b="0"+b;a="#"+d+c+b}}return a};EnvironmentComponent.prototype.getHttpResponse=function(d,g,b,c,f){try{var h=true;if(typeof currentCallContext=="undefined")return EnvironmentComponent.getHttpResponseSync(d,g,b,c,f);var e=getKeyForCallContext(d,b,c);if(!callContext[e])callContext[e]=currentCallContext;var a=callContext[e];if(a!=null&&!a.savedAsyncResult){var i=a.args,j=a.metadata.operationsHash[a.methodName].callMode;if(j=="auto"&&typeof i[i.length-1]=="function")h=false}if(h)if(a.savedAsyncResult){var k=a.savedAsyncResult;a.savedAsyncResult=null;return k}else return EnvironmentComponent.getHttpResponseSync(d,g,b,c,f);else{environment.getHttpResponseAsync(d,g,b,c,null,f);throw new AsyncOperationPendingException}}finally{HidePleaseWait()}};EnvironmentComponent.getHttpResponseSync=function(e,h,b,d,f){console.write("Getting data synchronously from "+e+"...");var a=new window.XMLHttpRequest,g=h==null?"":"&popflyKey="+h;if(d&&d.length>0)a.open("POST","/PublicServices/XDomainHttp.aspx?url="+escape(e)+g,false);else a.open("GET","/PublicServices/XDomainHttp.aspx?url="+escape(e)+g,false);if(b&&b.length>0)for(var c=0;c<b.length;c++)if(b[c]&&b[c].Key&&b[c].Value)a.setRequestHeader(b[c].Key,b[c].Value);if(d&&d.length>0)a.send(d);else a.send(null);if(f=="xml"||f=="text")if(a.readyState==4&&a.status&&(a.status+"").charAt(0)=="2")if(f=="xml")return a.responseXML;else return a.responseText;else throw"Unable to get data from '"+e+"' (error code "+a.status+").  The site may not currently be operational, so please don't shoot the messenger!";else return a};EnvironmentComponent.prototype.getHttpResponseAsync=function(f,i,b,e,g,d){console.write("Getting data from "+f+"...");var a=new window.XMLHttpRequest,h=i==null?"":"&popflyKey="+i;if(e&&e.length>0)a.open("POST","/PublicServices/XDomainHttp.aspx?url="+escape(f)+h,true);else a.open("GET","/PublicServices/XDomainHttp.aspx?url="+escape(f)+h,true);if(b&&b.length>0)for(var c=0;c<b.length;c++)if(b[c]&&b[c].Key&&b[c].Value)a.setRequestHeader(b[c].Key,b[c].Value);a.onreadystatechange=function(){if(a.readyState==4)if((d=="xml"||d=="text")&&(!a.status||(a.status+"").charAt(0)!="2"))environment.reportError("Unable to get data from '"+f+"' (error code "+a.status+").  The site may not currently be operational, so please don't shoot the messenger!");else{console.write("The call to "+f+" returned with status "+a.status+".");if(g)try{if(d=="xml")g(a.responseXML);else if(d=="text")g(a.responseText);else g(a)}catch(o){environment.reportError(o,c.metadata.blockId+": Error from "+c.methodName+": ")}else{var m=getKeyForCallContext(f,b,e),c=callContext[m];if(d=="xml")c.savedAsyncResult=a.responseXML;else if(d=="text")c.savedAsyncResult=a.responseText;else c.savedAsyncResult=a;var i=c.wrapper.__reserved.object,j=c.methodName,h=c.args,k=i[j],l=h[h.length-1];environment.endOperation(c.wrapper);try{var n=k.bindWithArgArray(i,h)();l(n)}catch(o){environment.reportError(o,c.metadata.blockId+": Error from "+j+": ")}}}};if(e&&e.length>0)a.send(e);else a.send(null)};EnvironmentComponent.prototype.getXml=function(d,c,a,b){return this.getHttpResponse(d,c,a,b,"xml")};EnvironmentComponent.getXmlSync=function(d,c,a,b){return this.getHttpResponseSync(d,c,a,b,"xml")};EnvironmentComponent.prototype.getProjectName=function(){return getQueryVariable("name")};EnvironmentComponent.prototype.getOwner=function(){return getQueryVariable("owner")};EnvironmentComponent.prototype.addAnonymousData=function(c,d,b,a){if(this.getProjectName()=="")return false;else{Microsoft.Springfield.Services.IDEServiceAnonymous.AddAnonymousData(this.getProjectName(),this.getOwner(),c,d,b,a);return true}};EnvironmentComponent.prototype.clearAnonymousData=function(c,b,a){if(this.designTime)throw"Load and Save UserData not enabled in preview mode. You must save and shared project to use this feature";else if(this.getProjectName()=="")return false;else Microsoft.Springfield.Services.IDEServiceAnonymous.ClearAnonymousData(this.getProjectName(),this.getOwner(),c,b,a)};EnvironmentComponent.prototype.loadAnonymousData=function(c,b,a){if(this.getProjectName()=="")return false;else{Microsoft.Springfield.Services.IDEServiceAnonymous.LoadAnonymousData(this.getProjectName(),this.getOwner(),c,b,a);return true}};Function.prototype.bindWithArgArray=function(b,c){var a=this;return function(){return a.apply(b,c)}};EnvironmentComponent.prototype.getXmlAsync=function(e,d,b,c,a){return this.getHttpResponseAsync(e,d,b,c,a,"xml")};EnvironmentComponent.prototype.getText=function(a){return this.getHttpResponse(a,null,null,null,"text")};EnvironmentComponent.getTextSync=function(a){return this.getHttpResponseSync(a,null,null,null,"text")};EnvironmentComponent.prototype.getTextAsync=function(b,a){return this.getHttpResponseAsync(b,null,null,null,a,"text")};EnvironmentComponent.prototype.addHtmlWithScript=function(a){if(this.designTime)throw"This operation injects script into the document, which is not supported at design time.";document.write(a)};EnvironmentComponent.prototype.output=function(a){environmentOutputHasBeenCalled=true;if(this.designTime)throw"This operation puts content on the screen, which is not supported at design time.";if(a==null||typeof a=="undefined"){console.write("environment.output was called with no data.","warning");return}if(a instanceof Array||typeof a==typeof []&&"length" in a){if(a.length==1)console.write("Outputting a single item...");else console.write("Outputting "+a.length+" items...");for(var c=0;c<a.length;c++){var b=a[c];if(a[c]==null||typeof a[c]=="undefined")b="[null] ";else if(a[c].toString)b=a[c].toString()+" ";var d=document.createElement("span");d.innerHTML=b;document.body.appendChild(d);if(!environmentHasContent&&b!=null&&b.trim().length>0)environmentHasContent=true}}else{console.write("Outputting a single item...");var b=a;if(a.toString)b=a.toString();var d=document.createElement("span");d.innerHTML=b;document.body.appendChild(d);if(!environmentHasContent&&b!=null&&b.trim().length>0)environmentHasContent=true}};EnvironmentComponent.prototype.dump=function(a){var b="";if(typeof a=="string"||typeof a=="number")return a;if(a instanceof Array||typeof a==typeof []&&"length" in a){if(a.length==1)b+="<b>"+a.length+" Item</b><br/>";else b+="<b>"+a.length+" Items</b><br/>";for(var d=0;d<a.length;d++){b+="<br/>Item #"+(d+1)+":<br/>";b+="<table cellspacing=2>";if(typeof a[d]=="string"||typeof a[d]=="number")b+="<tr><td>"+a[d]+"</td></tr>";else for(var c in a[d])if(c!="toString")b+="<tr><td>"+c+"</td><td>"+a[d][c]+"</td></tr>";b+="</table>"}}else for(var c in a)if(c!="toString"){b+="<table cellspacing=2>";b+="<tr><td>"+c+"</td><td>"+a[c]+"</td></tr>";b+="</table>"}return b};EnvironmentComponent.prototype.finish=function(){var a=document.getElementById("statusBubble");if(a&&a.innerHTML.indexOf("ERROR:")==-1)a.style.display="none"};EnvironmentComponent.prototype.getExceptionMessage=function(b){var a;if(typeof b=="string")a=b;else a=b.message;if(a==null||a.trim().length==0)a="An unknown error occurred.";return a};EnvironmentComponent.prototype.reportError=function(d,c){var a=this.getExceptionMessage(d);if(c)a=c+a;var b=document.getElementById("statusBubble");if(b)b.style.display="block";else alert("ERROR: "+a);console.write(a,"error")};EnvironmentComponent.prototype.reportErrorInLoop=function(a,c){var b=this.getExceptionMessage(c);console.write("Problem with item #"+(a+1)+": "+b,"warning")};EnvironmentComponent.prototype.escapeQuotes=function(a){if(typeof a!="string")return a;regx=new RegExp("/['\"]","g");strOut=a.replace(regx,function(a){return a=="'"?"&#39;":"&quot;"});return strOut};function ShowPleaseWait(a){if(environment.designTime){if($get("pleaseWaitText")==null||$find("pleaseWaitBehavior")==null)return;$get("pleaseWaitDIV").style.display="block";$get("loadingcontent").style.display="block";if(a){$get("pleaseWaitText").innerHTML=a;window.status=a}$find("pleaseWaitBehavior").show();return}if(a&&window&&window.status)window.status=a}function HidePleaseWait(){if(environment.designTime){if($find("pleaseWaitBehavior")==null)return;window.status="";$find("pleaseWaitBehavior").hide();$get("loadingcontent").style.display="none";return}if(window&&window.status)window.status=""}var componentManager={add:function(){}};function getQueryVariable(d){var e=window.location.search.substring(1),c=e.split("&");for(var a=0;a<c.length;a++){var b=c[a].split("=");if(unescape(b[0])==d)return unescape(b[1])}return ""}function getKeyForCallContext(e,a,c){var d=e;if(a&&a.length>0)for(var b=0;b<a.length;b++)if(a[b]&&a[b].Key&&a[b].Value)d+="|"+a[b].Key+"|"+a[b].Value;if(c&&c.length>0)d+="::"+c;return d}function extract(c,d){var b=[];for(var a=0;a<c.length;a++)b.push(c[a][d]);return b}function callbackInLoop(number,variable,callback){var functionString=callback+"";functionString=functionString.replaceAll("["+variable+"]","["+number+"]");eval("callbackInLoopTemp = "+functionString);return callbackInLoopTemp}function AnnotationPanel_OnLoad(){}function escapeHTML(c){var a=document.createElement("div"),b=document.createTextNode(c);a.appendChild(b);return a.innerHTML}var objectNodes=new Array(0),objectHash={};EnvironmentComponent.prototype.getComponentObjects=function(){return objectNodes};EnvironmentComponent.prototype.loadBlockMetadata=function(b,a){return blockMetadata[a]};EnvironmentComponent.prototype.parseBlockMetadata=function(d,R,U){var b=d.selectSingleNode("/block");if(!b)throw"Invalid XML.";var u=b.getAttribute("class");if(!u)throw"The attribute 'class' must be specified on the root node.";var F=b.getAttribute("hasInitialize"),O=b.getAttribute("type"),G=stringIfNull(b.selectSingleNode("providerName")),I=stringIfNull(b.selectSingleNode("providerUrl")),D=stringIfNull(b.selectSingleNode("providerLogoUrl")),M=stringIfNull(b.selectSingleNode("blockLogoUrl")),L=stringIfNull(b.selectSingleNode("blockIconUrl")),j=b.selectSingleNode("suggest"),p="",o="";if(j){p=j.getAttribute("input");o=j.getAttribute("output")}var g=d.selectSingleNode("/block/keys"),v=null;if(g){var K=stringIfNull(g.selectSingleNode("description")),N=g.selectSingleNode("signUpUrl").text,t=g.selectNodes("key"),z=new Array(0);for(var a=0;a<t.length;a++){var h=t[a],V=h.getAttribute("id"),J=h.getAttribute("whenRequired"),S=h.selectSingleNode("name").text,Q=stringIfNull(h.selectSingleNode("notes"));z[a]=new ComponentKey(V,J,S,Q)}v=new ComponentKeys(K,N,z)}var A=d.selectNodes("/block/objects/object"),l,k,c,q=new Array(0);for(var a=0;a<A.length;a++){l=A[a];var T=l.getAttribute("name");k=l.selectNodes("field");var y=new Array(0);for(var i=0;i<k.length;i++){c=k[i];y[i]=new ComponentField(c.getAttribute("name"),c.getAttribute("type"),c.getAttribute("isArray"),c.getAttribute("object"))}q[a]=new ComponentObject(T,y)}var w=d.selectNodes("/block/operations/operation"),m=new Array(0);for(var a=0;a<w.length;a++){var P=w[a];m[a]=parseOperation(P)}var x=d.selectNodes("/block/properties/property"),n=new Array(0);for(var a=0;a<x.length;a++){var f=x[a],s=f.getAttribute("name"),E=stringIfNull(f.selectSingleNode("description")).trim(),B=f.selectSingleNode("getter"),r=null;if(B)r=parseOperation(B.selectSingleNode("operation"));var C=f.selectSingleNode("setter"),e=null;if(C)e=parseOperation(C.selectSingleNode("operation"));if(!e||e.inputs.length!=1)throw"The property "+s+" needs a setter with one input.";n[a]=new ComponentProperty(s,E,r,e)}var H=new ComponentManifest(R,U,u,F,O,G,I,D,M,L,p,o,v,q,m,n);return H};EnvironmentComponent.prototype.construct=function(className,metadata,isLeafNode){if(!metadata)environment.reportError("This mashup uses one or more blocks that are no longer available");eval(this.generateWrapperCode(metadata)+"\n__"+className+"Wrapper = new "+className+"Wrapper();");if(isLeafNode)window["__"+className+"Wrapper"].__reserved.leaf=true;return window["__"+className+"Wrapper"]};function parseOperation(d){var G=d.getAttribute("name"),D=stringIfNull(d.selectSingleNode("description")),F=d.getAttribute("callMode"),w=d.selectNodes("inputs/input"),r,o,s,j,q,p,n,c,H,h,u=new Array(0);for(var b=0;b<w.length;b++){var a=w[b];r=a.getAttribute("name");o=a.getAttribute("required");s=a.getAttribute("type");q=a.getAttribute("object");p=a.getAttribute("isArray");n=stringIfNull(a.selectSingleNode("description"));j=stringIfNull(a.selectSingleNode("defaultValue"));var i=a.selectNodes("constraints/constraint"),m=new Array(0);for(var f=0;f<i.length;f++){c=i[f];inputConstraintMandatory=c.getAttribute("mandatory");h=c.getAttribute("type");var k=c.selectNodes("value"),A=stringIfNull(c.selectSingleNode("minValue"),null),z=stringIfNull(c.selectSingleNode("maxValue"),null),g=new Array(0);for(l=0;l<k.length;l++)g[l]=k[l].text;m[f]=new ComponentConstraint(inputConstraintMandatory,h,g,A,z)}u[b]=new ComponentInput(r,o,s,q,p,n,j,m)}var v=d.selectNodes("outputs/output"),t=new Array(0);for(var b=0;b<v.length;b++){var e=v[b],B=e.getAttribute("isArray"),E=e.getAttribute("type"),C=e.getAttribute("object"),x=e.getAttribute("function");t[b]=new ComponentOutput(E,B,C,x)}var y=new ComponentOperation(G,D,F,u,t);return y}function ComponentManifest(q,r,o,l,p,h,k,f,n,m,i,g,s,d,b,c){this.blockId=q;this.version=r;this.blockClass=o;this.hasInitialize=l;this.blockType=p;this.blockProviderName=h;this.blockProviderUrl=k;this.blockProviderLogoUrl=f;this.blockLogoUrl=n;this.blockIconUrl=m;this.blockSuggestInput=i;this.blockSuggestOutput=g;this.keys=s;this.objects=d;this.operations=b;this.properties=c;this.objectsHash={};if(d&&d.length>0)for(var a=0;a<d.length;a++)this.objectsHash[d[a].name]=d[a];this.propertySettersHash={};if(c&&c.length>0)for(var a=0;a<c.length;a++)this.propertySettersHash[c[a].setter.name]=c[a].setter;this.operationsHash={};if(b&&b.length>0)for(var a=0;a<b.length;a++){this.operationsHash[b[a].name]=b[a];if(b[a].outputs&&b[a].outputs.length>0)for(j=0;j<b[a].outputs.length;j++){var e=b[a].outputs[j];if(e.type=="custom"&&this.objectsHash[e.object])e.staticFields=this.objectsHash[e.object].staticFields}}}function ComponentKeys(a,b,c){this.description=a;this.signUpUrl=b;this.keys=c}function ComponentKey(b,a,d,c){this.id=b;this.whenRequired=a;this.name=d;this.notes=c}function ComponentObject(b,a){this.name=b;this.staticFields=a}function ComponentField(c,d,a,b){this.name=c;this.type=d;this.isArray=a;this.object=b}function ComponentOperation(f,c,d,a,e){this.name=f;this.description=c;this.callMode=d;this.inputs=a;this.outputs=e;this.inputsHash={};if(a&&a.length>0)for(var b=0;b<a.length;b++)this.inputsHash[a[b].name]=a[b]}function ComponentProperty(d,a,b,c){this.name=d;this.description=a;this.getter=b;this.setter=c}function ComponentInput(g,e,h,f,a,d,b,c){this.name=g;this.required=e;this.type=h;this.object=f;this.isArray=a==null?"false":a;this.description=d;this.defaultValue=b;this.constraints=c}function ComponentConstraint(a,e,d,c,b){this.mandatory=a;this.type=e;this.values=d;this.minValue=c;this.maxValue=b}function ComponentOutput(d,b,c,a){this.type=d;this.isArray=b;this.object=c;this.isDynamic=false;this.dynamicFunction=a;if(this.dynamicFunction){this.isDynamic=true;this.object="dynamic"}this.staticFields=null;this.getFields=function(b){if(this.dynamicFunction){var g=window[Utils.getVariableName(b.blockId)],i=null;try{var e=[];for(var c=0;c<b.chosenInputValues.length;c++)if(b.chosenInputValues[c][0]=="[custom]")e[c]=b.chosenInputValues[c][1];else e[c]=null;var i=g.__reserved.object[a].bindWithArgArray(g.__reserved.object,e)()}catch(l){environment.reportError(l,"Unexpected error from "+b.blockId+": ");return null}try{var k=window.XMLDOM(i),j=k.selectSingleNode("/object"),h=j.selectNodes("field"),f=new Array(0);for(var d=0;d<h.length;d++){field=h[d];f[d]=new ComponentField(field.getAttribute("name"),field.getAttribute("type"),field.getAttribute("isArray"),field.getAttribute("object"))}return f}catch(l){environment.reportError(b.blockId+"'s "+a+" function returned an invalid dynamic type.")}}return this.staticFields}}EnvironmentComponent.prototype.generateWrapperCode=function(e){var i=e.blockClass+"Wrapper",a="function "+i+"() { this.__reserved = new Object();";a+=" this.__reserved.object = new "+e.blockClass+"(); }";var l=e.operations.length;if(e.hasInitialize)a+=i+".prototype.initialize = function() { this.__reserved.object.initialize(); };\n";for(var h=0;h<l;h++){var b=e.operations[h];a+=i+".prototype."+b.name+" = function(";var d="",g="",f=b.inputs.length;if(b.callMode=="async")f++;for(var c=0;c<f;c++)if(b.callMode=="async"&&c==f-1){d+="callback";g+="function() { environment.endOperation(that); callback(arguments[0]); }"}else{var k=b.inputs[c];d+=k.name;g+="convertedArgs["+c+"]";if(c<f-1){d+=",";g+=","}}a+=d+") { var that = this;";a+=" var convertedArgs = validateArguments(blockMetadata['"+e.blockId+"'], '"+b.name+"', arguments);";a+=" environment.beginOperation(blockMetadata['"+e.blockId+"'], this, '"+b.name+"', convertedArgs);";a+=" try { var r = this.__reserved.object."+b.name+"("+g+");";if(b.callMode!="async")a+=" environment.endOperation(this);";a+=" return r; }";a+=" catch (ex) { if (!ex.asyncOperationPending) { environment.endOperation(this); throw '"+e.blockId+": Error from "+b.name+": ' + environment.getExceptionMessage(ex); } }";a+="};"}l=e.properties.length;for(var h=0;h<l;h++){var j=e.properties[h];if(j.getter){var b=j.getter;a+=i+".prototype."+b.name+" = function(";var d="",f=b.inputs.length;for(var c=0;c<f;c++){var k=b.inputs[c];d+=k.name;if(c<f-1)d+=","}a+=d+") {";a+=" return this.__reserved.object."+b.name+"("+d+");";a+="};"}if(j.setter){var b=j.setter;a+=i+".prototype."+b.name+" = function(";var d="",g="",f=b.inputs.length;for(var c=0;c<f;c++){var k=b.inputs[c];d+=k.name;g+="convertedArgs["+c+"]";if(c<f-1){d+=",";g+=","}}a+=d+") {";a+=" var convertedArgs = validateArguments(blockMetadata['"+e.blockId+"'], '"+b.name+"', arguments, '"+j.name+"');";a+=" return this.__reserved.object."+b.name+"("+g+");";a+="};"}}return a};EnvironmentComponent.prototype.beginOperation=function(e,h,f,a){if(!e)throw"beginOperation has been called without a valid block!";var d="",g=a.length;if(a.length>0&&typeof a[a.length-1]=="function")g--;for(var b=0;b<g;b++){var c=a[b];if(typeof a[b]=="string")c='"'+c+'"';if(b==0)d+=c;else d+=", "+c}console.write(e.blockId+": Calling "+f+"("+d+")...");currentCallContext=new CallContext(e,h,f,a)};EnvironmentComponent.prototype.endOperation=function(a){a.__reserved.pendingCalls--;if(a.__reserved.pendingCalls==0&&a.__reserved.leaf)environment.finish()};function AsyncOperationPendingException(){this.asyncOperationPending=true}function CallContext(b,c,a,d){this.metadata=b;this.wrapper=c;this.methodName=a;this.args=d}function validateArguments(e,d,b,h){var g=null;if(h)g=e.propertySettersHash[d];else g=e.operationsHash[d];var i=g.inputs.length;for(var a=0;a<i;a++){var f=g.inputs[a];if(!f)break;if(f.isArray=="true"){if(b[a]==null||b[a]==undefined||!b[a].length)b[a]=[b[a]];for(var c=0;c<b[a].length;c++)b[a][c]=validateSingleArgument(e,f,d,b[a][c],c,h)}else b[a]=validateSingleArgument(e,f,d,b[a],null,h)}return b}function validateSingleArgument(f,c,u,b,l,q){var m="",k=" a color",j=" a number",p=" a whole number",e="",d=u+" operation";if(q)d=q+" property";if(l!=null&&l!=undefined){m=" a list of";k=" a list of colors";j=" a list of numbers";p=" a list of whole numbers";e=" for item #"+(l+1)}if(l==null&&c.required=="true"&&(b==null||b==undefined||b===""))throw f.blockId+"'s "+d+" requires a value for "+c.name+", but no value has been given!";if(b!=null&&b!=undefined&&b!==""){var g=getAllowedValuesForInput(c);for(var n=0;n<g.length;n++)if(g[n]+""==b+"")break;if(g.length>0&&n==g.length)if(g.length==1)throw f.blockId+"'s "+d+" requires"+m+" the value "+g[0]+" for "+c.name+". However, the value "+b+" has been given instead"+e+"!";else if(g.length==2)throw f.blockId+"'s "+d+" requires"+m+" the value "+g[0]+" or "+g[1]+" for "+c.name+". However, the value "+b+" has been given instead"+e+"!";else throw f.blockId+"'s "+d+" requires"+m+" one of the following values for "+c.name+": "+g.toString()+". However, the value "+b+" has been given instead"+e+"!";switch(c.type){case "numericId":case "nonNegativeInteger":var i=new Number(b);if(isNaN(i))throw f.blockId+"'s "+d+" requires"+j+" for "+c.name+', but "'+b+'" has been given instead'+e+"!";if(i<0)throw f.blockId+"'s "+d+" requires"+j+" greater than or equal to zero for "+c.name+", but "+b+" has been given instead"+e+"!";case "integer":var i=new Number(b);if(isNaN(i))throw f.blockId+"'s "+d+" requires"+j+" for "+c.name+', but "'+b+'" has been given instead'+e+"!";if(Math.round(i)!=i)throw f.blockId+"'s "+d+" requires"+p+" for "+c.name+", but "+b+" has been given instead"+e+"!";case "decimal":case "latitude":case "longitude":var i=Number(b);if(isNaN(i))throw f.blockId+"'s "+d+" requires"+j+" for "+c.name+', but "'+b+'" has been given instead'+e+"!";var r=c.constraints;for(var o=0;o<r.length;o++){var h=r[o];if(h.type=="minValue"&&h.values&&h.values[0]){var t=new Number(h.values[0]);if(i<t)throw f.blockId+"'s "+d+" requires"+j+" greater than or equal to "+t+" for "+c.name+", but "+b+" has been given instead"+e+"!"}if(h.type=="maxValue"&&h.values&&h.values[0]){var s=new Number(h.values[0]);if(i>s)throw f.blockId+"'s "+d+" requires"+j+" less than or equal to "+s+" for "+c.name+", but "+b+" has been given instead"+e+"!"}}break;case "htmlColor":var a=b.toLowerCase();if(a.match(new RegExp("^#[0-9A-F]{3}$","i"))==null&&a.match(new RegExp("^#[0-9A-F]{6}$","i"))==null&&a!="aqua"&&a!="black"&&a!="blue"&&a!="fuchsia"&&a!="green"&&a!="gray"&&a!="lime"&&a!="maroon"&&a!="navy"&&a!="olive"&&a!="purple"&&a!="red"&&a!="silver"&&a!="teal"&&a!="white"&&a!="yellow")throw f.blockId+"'s "+d+" requires"+k+" for "+c.name+". However, the value "+b+" has been given instead"+e+"!";break;case "backgroundColor":var a=b.toLowerCase();if(a.match(new RegExp("^#[0-9A-F]{3}$","i"))==null&&a.match(new RegExp("^#[0-9A-F]{6}$","i"))==null&&a!="aqua"&&a!="black"&&a!="blue"&&a!="fuchsia"&&a!="green"&&a!="gray"&&a!="lime"&&a!="maroon"&&a!="navy"&&a!="olive"&&a!="purple"&&a!="red"&&a!="silver"&&a!="teal"&&a!="white"&&a!="yellow"&&a!="transparent")throw f.blockId+"'s "+d+" requires"+k+" for "+c.name+". However, the value "+b+" has been given instead"+e+"!";break;case "color":case "silverlightColor":var a=b.toLowerCase();if(a.match(new RegExp("^#[0-9A-F]{3}$","i"))==null&&a.match(new RegExp("^#[0-9A-F]{4}$","i"))==null&&a.match(new RegExp("^#[0-9A-F]{6}$","i"))==null&&a.match(new RegExp("^#[0-9A-F]{8}$","i"))==null&&a!="aqua"&&a!="black"&&a!="blue"&&a!="fuchsia"&&a!="green"&&a!="gray"&&a!="lime"&&a!="maroon"&&a!="navy"&&a!="olive"&&a!="purple"&&a!="red"&&a!="silver"&&a!="teal"&&a!="white"&&a!="yellow"&&a!="transparent")throw f.blockId+"'s "+d+" requires"+k+" for "+c.name+". However, the value "+b+" has been given instead"+e+"!"}switch(c.type){case "nonNegativeInteger":case "integer":case "decimal":case "latitude":case "longitude":b=new Number(b);break;case "boolean":if(b+""=="true")b=true;else b=false;break;default:if(typeof b=="number")b=b+""}}return b}function getAllowedValuesForInput(f){var a=[];if(f.type=="boolean"){a.push("true");a.push("false");return a}var e=f.constraints;for(var c=0;c<e.length;c++){var b=e[c];if(b.type=="oneOf"&&b.values){for(var d=0;d<b.values.length;d++)a.push(b.values[d]);break}}return a}var uninitializedBlocks=[];function Utils(){}HttpGet=function(b,c){var a=new window.XMLHttpRequest;a.open("GET",b,false);a.send(null);if(a.readyState==4&&a.status=="200")if(c)return a.responseXML;else return a.responseText;else throw"Unable to get data from '"+b+"' (error code "+a.status+")."};function blockScriptLoaded(id,version,content,errorMessage){if(errorMessage){environment.reportError(errorMessage,"There was an error loading the "+id+" block and this project may not function properly. Ensure that the block exists and that it has valid content. \nDetails: ");return}var blockInstance=uninitializedBlocks[id];if(content){if(!blockInstance&&environment.designTime){environment.reportError("Could not find the uninitialized block "+id);return}try{var xml=window.XMLDOM(content);blockMetadata[id]=environment.parseBlockMetadata(xml,id,version);if(blockInstance){blockInstance.metadata=blockMetadata[id];blockInstance.processMetadata();if(window.inFullMashupDesigner){var script=environment.generateWrapperCode(blockMetadata[id])+"\n"+Utils.getVariableName(blockMetadata[id].blockId)+" = new "+blockMetadata[id].blockClass+"Wrapper();";eval(script)}uninitializedBlocks[id]=null}}catch(a){environment.reportError(a,"Sorry, the "+id+" block has an internal error.\n\nTechnical details:\nUnable to load XML manifest: ");if(blockInstance&&blockInstance.closeButton){blockInstance.loading=false;blockInstance.closeButton.onMouseUp()}}}else if(environment.designTime)Utils.addExternalScript("http://www.popfly.ms"+blockInstance.url+"?format=jstring&context="+blockInstance.blockId+"&v="+version)}Utils.addExternalScript=function(b){var a=document.createElement("script");a.type="text/javascript";a.src=b;document.getElementsByTagName("head")[0].appendChild(a)};Utils.getVariableName=function(a){a=a.replace(new RegExp("^\\d|[^A-Za-z0-9_]","g"),"_");return a};EnvironmentComponent.getComponentId=function(c){var b=null,g=/\/blocks\/(.+?)\./i,e=/\/content\/components\/(.+?)\./i,f=/\/users\/(.+?)\/default\./i,a=c.match(g);if(a!=null)b=a[1];else{var d=c.match(f);if(d!=null)b="_"+d[1].replace("/","_");else{a=c.match(e);if(a!=null)b=a[1]}}if(!b)throw"Could not determine id from URL: "+c;return b};EnvironmentComponent.getCodeUrl=function(a){var c="";if(a.startsWith("_")){var b=a.indexOf("_",1),e=a.substr(1,b-1),d=a.substr(b+1,a.length-b-1);c="/users/"+e+"/"+d+"/default.js"}else c="/blocks/"+a+".js";return c};if(!window.Silverlight)window.Silverlight={};Silverlight._silverlightCount=0;Silverlight.ua=null;Silverlight.available=false;Silverlight.fwlinkRoot="http://go.microsoft.com/fwlink/?LinkID=";Silverlight.detectUserAgent=function(){var a=window.navigator.userAgent;Silverlight.ua={OS:"Unsupported",Browser:"Unsupported"};if(a.indexOf("Windows NT")>=0)Silverlight.ua.OS="Windows";else if(a.indexOf("PPC Mac OS X")>=0)Silverlight.ua.OS="MacPPC";else if(a.indexOf("Intel Mac OS X")>=0)Silverlight.ua.OS="MacIntel";if(Silverlight.ua.OS!="Unsupported")if(a.indexOf("MSIE")>=0){if(navigator.userAgent.indexOf("Win64")==-1)if(parseInt(a.split("MSIE")[1])>=6)Silverlight.ua.Browser="MSIE"}else if(a.indexOf("Firefox")>=0){var b=a.split("Firefox/")[1].split("."),c=parseInt(b[0]);if(c>=2)Silverlight.ua.Browser="Firefox";else{var d=parseInt(b[1]);if(c==1&&d>=5)Silverlight.ua.Browser="Firefox"}}else if(a.indexOf("Safari")>=0)Silverlight.ua.Browser="Safari"};Silverlight.detectUserAgent();Silverlight.isInstalled=function(d){var c=false,a=null;try{var b=null;if(Silverlight.ua.Browser=="MSIE")b=new ActiveXObject("AgControl.AgControl");else if(navigator.plugins["Silverlight Plug-In"]){a=document.createElement("div");document.body.appendChild(a);if(Silverlight.ua.Browser=="Safari")a.innerHTML='<embed type="application/x-silverlight" />';else a.innerHTML='<object type="application/x-silverlight"  data="data:," />';b=a.childNodes[0]}document.body.innerHTML;if(b.IsVersionSupported(d))c=true;b=null;Silverlight.available=true}catch(e){c=false}if(a)document.body.removeChild(a);return c};Silverlight.createObject=function(l,g,m,j,k,i,h){var b={},a=j,c=k;a.source=l;b.parentElement=g;b.id=Silverlight.HtmlAttributeEncode(m);b.width=Silverlight.HtmlAttributeEncode(a.width);b.height=Silverlight.HtmlAttributeEncode(a.height);b.ignoreBrowserVer=Boolean(a.ignoreBrowserVer);b.inplaceInstallPrompt=Boolean(a.inplaceInstallPrompt);var e=a.version.split(".");b.shortVer=e[0]+"."+e[1];b.version=a.version;a.initParams=i;a.windowless=a.isWindowless;a.maxFramerate=a.framerate;for(var d in c)if(c[d]&&d!="onLoad"&&d!="onError"){a[d]=c[d];c[d]=null}delete a.width;delete a.height;delete a.id;delete a.onLoad;delete a.onError;delete a.ignoreBrowserVer;delete a.inplaceInstallPrompt;delete a.version;delete a.isWindowless;delete a.framerate;delete a.data;delete a.src;if(Silverlight.isInstalled(b.version)){if(Silverlight._silverlightCount==0)if(window.addEventListener)window.addEventListener("onunload",Silverlight.__cleanup,false);else window.attachEvent("onunload",Silverlight.__cleanup);var f=Silverlight._silverlightCount++;a.onLoad="__slLoad"+f;a.onError="__slError"+f;window[a.onLoad]=function(a){if(c.onLoad)c.onLoad(document.getElementById(b.id),h,a)};window[a.onError]=function(a,b){if(c.onError)c.onError(a,b);else Silverlight.default_error_handler(a,b)};slPluginHTML=Silverlight.buildHTML(b,a)}else slPluginHTML=Silverlight.buildPromptHTML(b);if(b.parentElement)b.parentElement.innerHTML=slPluginHTML;else return slPluginHTML};Silverlight.supportedUserAgent=function(){var a=Silverlight.ua,b=a.OS=="Unsupported"||a.Browser=="Unsupported"||a.OS=="Windows"&&a.Browser=="Safari"||a.OS.indexOf("Mac")>=0&&a.Browser=="IE";return !b};Silverlight.buildHTML=function(c,d){var a=[],e,i,g,f,h;if(Silverlight.ua.Browser=="Safari"){a.push("<embed ");e="";i=" ";g='="';f='"';h=' type="application/x-silverlight"/>'+"<iframe style='visibility:hidden;height:0;width:0'/>"}else{a.push('<object type="application/x-silverlight" data="data:,"');e=">";i=' <param name="';g='" value="';f='" />';h="</object>"}a.push(' id="'+c.id+'" width="'+c.width+'" height="'+c.height+'" '+e);for(var b in d)if(d[b])a.push(i+Silverlight.HtmlAttributeEncode(b)+g+Silverlight.HtmlAttributeEncode(d[b])+f);a.push(h);return a.join("")};Silverlight.default_error_handler=function(e,b){var d,c=b.ErrorType;d=b.ErrorCode;var a="\nSilverlight error message     \n";a+="ErrorCode: "+d+"\n";a+="ErrorType: "+c+"       \n";a+="Message: "+b.ErrorMessage+"     \n";if(c=="ParserError"){a+="XamlFile: "+b.xamlFile+"     \n";a+="Line: "+b.lineNumber+"     \n";a+="Position: "+b.charPosition+"     \n"}else if(c=="RuntimeError"){if(b.lineNumber!=0){a+="Line: "+b.lineNumber+"     \n";a+="Position: "+b.charPosition+"     \n"}a+="MethodName: "+b.methodName+"     \n"}alert(a)};Silverlight.createObjectEx=function(b){var a=b,c=Silverlight.createObject(a.source,a.parentElement,a.id,a.properties,a.events,a.initParams,a.context);if(a.parentElement==null)return c};Silverlight.buildPromptHTML=function(l){var a=null,d=Silverlight.fwlinkRoot,c=Silverlight.ua.OS,b="92822",e,f="Get Microsoft Silverlight",m="0x409";if(l.inplaceInstallPrompt){var n="98109",i;if(Silverlight.available){e="96189";i="96422"}else{e="96188";i="96422"}var h="93481",g="93483";if(c=="Windows"){b="92799";h="92803";g="92805"}else if(c=="MacIntel"){b="92808";h="92804";g="92806"}else if(c=="MacPPC"){b="92807";h="92815";g="92816"}var k='By clicking <b>"Get Microsoft Silverlight"</b> you accept the<br /><a title="Silverlight License Agreement" href="{2}" target="_top" style="text-decoration: underline; color: #96C5E1"><b>Silverlight license agreement</b></a>',j='Silverlight updates automatically, <a title="Silverlight Privacy Statement" href="{3}" target="_top" style="text-decoration: underline; color: #96C5E1"><b>learn more</b></a>';a='<table border="0" cellpadding="0" cellspacing="0" width="206px"><tr><td><img style="display: block; cursor: pointer; border= 0;" title="'+f+'" alt="'+f+'" onclick="javascript:Silverlight.followFWLink({0});" src="{1}" /></td></tr><tr><td style="width: 206px; margin: 0px; background: #FFFFFF; color: #C7C7C7; text-align: left; border-left-style: solid; border-right-style: solid; padding-left: 6px; padding-right: 6px; padding-top: 3px; padding-bottom: 0px; border-width: 2px; border-color: #c7c7bd; font-family: Verdana; font-size: 55%">'+k+'</td></tr><tr><td><img src="{5}" style="border: 0; display: block" /></td></tr><tr><td style="width: 206px; margin: 0px; background: #D8EFF9; color: #C7C7C7; text-align: left; border-left-style: solid; border-right-style: solid; padding-left: 6px; padding-right: 6px; padding-top: 0px; padding-bottom: 2px; border-width: 2px; border-color: #c7c7bd; font-family: Verdana; font-size: 55%">'+j+'</td></tr><tr><td><img alt="" src="{4}" /></td></tr></table>';a=a.replace("{2}",d+h);a=a.replace("{3}",d+g);a=a.replace("{4}",d+i);a=a.replace("{5}",d+n)}else{if(Silverlight.available)e="94377";else e="92801";if(c=="Windows")b="92800";else if(c=="MacIntel")b="92812";else if(c=="MacPPC")b="92811";a='<div style="display:block; width: 205px; height: 67px;"><img onclick="javascript:Silverlight.followFWLink({0});" style="border:0; cursor:pointer" src="{1}" title="'+f+'" alt="'+f+'"/></div>'}a=a.replace("{0}",b);a=a.replace("{1}",d+e+"&amp;clcid="+m);return a};Silverlight.__cleanup=function(){for(var a=Silverlight._silverlightCount-1;a>=0;a--){window["__slLoad"+a]=null;window["__slError"+a]=null}if(window.removeEventListener)window.removeEventListener("unload",Silverlight.__cleanup,false);else window.detachEvent("onunload",Silverlight.__cleanup)};Silverlight.followFWLink=function(a){top.location=Silverlight.fwlinkRoot+String(a)};Silverlight.HtmlAttributeEncode=function(c){var a,b="";if(c==null)return null;for(var d=0;d<c.length;d++){a=c.charCodeAt(d);if(a>96&&a<123||a>64&&a<91||a>43&&a<58&&a!=47||a==95)b=b+String.fromCharCode(a);else b=b+"&#"+a+";"}return b};function delegate(b,a){var c=function(){a.apply(b,arguments)};return c}Function.prototype.bind=function(b){var a=this;return function(){a.apply(b,arguments)}};String.prototype.replaceAll=function(b,d){var a=this,c=a.indexOf(b);while(c!=-1){a=a.replace(b,d);c=a.indexOf(b)}return a};if(!window.Silverlight)window.Silverlight={};Silverlight.InstallAndCreateSilverlight=function(a){if(Silverlight.supportedUserAgent())if(Silverlight.isInstalled(a.properties.version))Silverlight.createObjectEx(a);else{a.parentElement.innerHTML="<span style='color:black;'>To view this you need to install Microsoft Silverlight by clicking the button below</span><div id='silverlightInstallPromptHost'/>";var b=a.parentElement.getElementsByTagName("div")[0];b.innerHTML=Silverlight.createObject(null,null,null,{version:a.properties.version,inplaceInstallPrompt:true},{},null);Silverlight.InstallAndCreateSilverlightInt(a)}else a.parentElement.innerHTML="<span style='color:black;'>This content requires Microsoft Silverlight.  The browser you are currently using is not Silverlight enabled.  Please give this a try with Microsoft Internet Explorer (32-bit) or Mozilla Firefox.</span>"};Silverlight.InstallAndCreateSilverlightInt=function(a){var b=3000;if(Silverlight.isInstalled(a.properties.version))Silverlight.createObjectEx(a);else setTimeout(function(){Silverlight.InstallAndCreateSilverlightInt(a)},b)};Silverlight.downloaderOpen=function(c,a,b){a.open("GET",b)};function createSilverlightBlockEx(b){var a=b;if(!a.properties)a.properties={};if(!a.events)a.events={};a={source:a.source,parentElement:a.parentElement,id:b.id,properties:{width:a.properties.width||"100%",height:a.properties.height||"100%",background:a.properties.background||"#00000000",framerate:a.properties.framerate||"30",isWindowless:a.properties.isWindowless||"true",inplaceInstallPrompt:"true",version:a.properties.version||"1.0"},events:{onLoad:a.onLoad||a.events.onLoad,onError:onSilverlightError}};Silverlight.InstallAndCreateSilverlight(a)}function onSilverlightError(c,b){var a="Silverlight ";a+=b.errorType+" ";a+=b.errorCode+":\n";a+=b.errorMessage+"\n";switch(b.errorType){case "RuntimeError":if(b.lineNumber!=0){a+="Line: "+b.lineNumber+"\n";a+="Position: "+b.charPosition+"\n"}a+="MethodName: "+b.methodName+"\n";break;case "ParserError":a+="Xaml File:      "+b.xamlFile+"\n";a+="Xml Element:    "+b.xmlElement+"\n";a+="Xml Attribute:  "+b.xmlAttribute+"\n";a+="Line:           "+b.lineNumber+"\n";a+="Position:       "+b.charPosition+"\n";break;case "ImageError":a+="Image Source:   "+c.Source+"\n";a+="Element Name:   "+c.Name+"\n";if(c.Source&&typeof c.Source=="string"){var d=c.Source.toLowerCase();if(d.indexOf("http://")==0&&d.indexOf("imageproxy")==-1){window.setTimeout(function(){c.Source="http://popflycreator.ms/publicservices/imageproxy.aspx?url="+encodeURIComponent(c.Source)},100);a+="(retry with image proxy)\n";console.write(a);return}}}console.write(a,"error")}var statusBubbleIsShowingError=false;if(typeof console=="undefined"){console={};console.log=function(){}}console.clear=function(){statusBubbleIsShowingError=false;console.write("")};console.write=function(a,c){var d=document.getElementById("statusBubble"),b=a;if(c=="error"){b="<font color='red'>ERROR: "+escapeHTML(a)+"</font>";a="ERROR: "+a}else if(c=="warning"){b="<font color='brown'>WARNING: "+escapeHTML(a)+"</font>";a="WARNING: "+a}else if(c=="heading")b="<font color='blue'><b>"+escapeHTML(a)+"</b></font>";else b=escapeHTML(a);if(d)if(c=="error"&&!statusBubbleIsShowingError){d.innerHTML="<img src='http://popflycreator.ms/Images/closeError.png' style='float:left' alt='click here to close error' title='click here to close error' onclick='console.clear()'/>"+b;statusBubbleIsShowingError=true}else if(!statusBubbleIsShowingError)if(environment.previewTime)d.innerHTML=b;else d.innerHTML+=".";try{var e=parent.document.getElementById("consoleBox");if(e){e.innerHTML+=b+"<br/>";e.scrollTop=99999;e.scrollTop=99999}}catch(f){}if(console.log)console.log(a);if(console.trace&&c=="error")console.trace()}