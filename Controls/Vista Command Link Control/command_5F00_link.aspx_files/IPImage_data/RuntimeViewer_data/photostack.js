var MAX_PHOTOS=12,PHOTOCOUNT,currentlyFlipping=false,mode="stack",wpf,inkPresenter,newStroke,erasePoints,photoParent,photoStackTitle;function root_Loaded(a){wpf=document.getElementById("PhotoStackSilverlightControl");inkPresenter=a.findname("inkPresenter1");photoParent=a.findname("photoParent");wpf.content.findname("toolbarPanDown").Begin();photoStackTitle=a.findname("photoStackTitle");PHOTOCOUNT=0;photoStackTitle.Foreground=environment.getPreferredTextColor()}function PhotoMouseDown(e,a){if(!currentlyFlipping)if(mode=="thumbnail"){var b=e.Name.replace("inkPresenter",""),c=wpf.content.findname("photoCanvas"+b);photoParent.Children.Remove(c);photoParent.Children.Add(c);toStackMode()}else if(mode=="stack"){var d=a.getStylusInfo(),b=photoParent.Children.GetItem(PHOTOCOUNT-1).Name.replace("photoCanvas","");inkPresenter=wpf.content.findName("inkPresenter"+b);inkPresenter.CaptureMouse();if(!d.isInverted){newStroke=wpf.content.createFromXaml("<Stroke/>");newStroke.StylusPoints.AddStylusPoints(a.GetStylusPoints(inkPresenter));newStroke.DrawingAttributes.Color="#FFFF55";newStroke.DrawingAttributes.OutlineColor="black";newStroke.DrawingAttributes.Width=5;newStroke.DrawingAttributes.Height=5;inkPresenter.Strokes.Add(newStroke)}else{erasePoints=wpf.content.createFromXaml("<StylusPointCollection/>");erasePoints.addStylusPoints(a.getStylusPoints(inkPresenter))}}}function PhotoMouseMove(e,a){var d=a.getStylusInfo();if(inkPresenter==null){var c=photoParent.Children.GetItem(PHOTOCOUNT-1).Name.replace("photoCanvas","");inkPresenter=wpf.content.findName("inkPresenter"+c)}if(newStroke!=null)newStroke.StylusPoints.AddStylusPoints(a.GetStylusPoints(inkPresenter));else if(d.isInverted&&erasePoints!=null){erasePoints.addStylusPoints(a.getStylusPoints(inkPresenter));var b=inkPresenter.strokes.hitTest(erasePoints);for(i=0;i<b.count;i++)inkPresenter.strokes.remove(b.getItem(i))}}function PhotoMouseUp(){newStroke=null;inkPresenter=null;erasePoints=null}function PhotoMouseEnter(d){if(mode=="thumbnail"){var b=PhotoStackClass.photos,e=new Number(d.name.replace(/[^\d]/g,"")),a=(e-1)%b.length,c;if(b[a])c=b[a].title;else c="Photograph #"+a;photoStackTitle.Text=c;wpf.content.findname("focusInGrid"+e).Begin();d["Canvas.ZIndex"]=1}}function PhotoMouseLeave(a){if(mode=="thumbnail"){var c=PhotoStackClass.photos,b=new Number(a.name.replace(/[^\d]/g,"")),d=(b-1)%c.length;photoStackTitle.Text="";wpf.content.findname("focusOutGrid"+b).Begin();a["Canvas.ZIndex"]=0}}function FlipNextPhoto(){if(!currentlyFlipping){currentlyFlipping=true;var a=photoParent.Children.GetItem(PHOTOCOUNT-1).Name.replace("photoCanvas","");wpf.content.findname("rotateRight"+a).Begin();setTimeout("resumeFollowingFlipRightNext()",500)}}function resumeFollowingFlipRightNext(){var a=photoParent.Children.GetItem(PHOTOCOUNT-1).Name.replace("photoCanvas",""),b=wpf.content.findname("photoCanvas"+a);photoParent.Children.Remove(b);photoParent.Children.Insert(0,b);wpf.content.findname("rotateLeft"+a).Begin();currentlyFlipping=false}function FlipPreviousPhoto(){if(!currentlyFlipping){currentlyFlipping=true;var a=photoParent.Children.GetItem(0).Name.replace("photoCanvas","");wpf.content.findname("rotateRight"+a).Begin();setTimeout("resumeFollowingFlipPrev()",500)}}function resumeFollowingFlipPrev(){var a=photoParent.Children.GetItem(0).Name.replace("photoCanvas",""),b=wpf.content.findname("photoCanvas"+a);photoParent.Children.Remove(b);photoParent.Children.Add(b);wpf.content.findname("rotateLeft"+a).Begin();currentlyFlipping=false}function toggleGridView(){if(mode=="stack")toThumbnailMode();else if(mode=="thumbnail")toStackMode()}function toThumbnailMode(){mode="thumbnail";for(var a=1;a<=PHOTOCOUNT;a++)wpf.content.findname("slideToGrid"+a).Begin();wpf.content.findname("gridIcon").Opacity=0;wpf.content.findname("gridIcon").IsHitTestVisible=false;wpf.content.findname("stackIcon").Opacity=1;wpf.content.findname("stackIcon").IsHitTestVisible=true;wpf.content.findname("backArrow").Opacity=0;wpf.content.findname("backArrow").IsHitTestVisible=false;wpf.content.findname("forwardArrow").Opacity=0;wpf.content.findname("forwardArrow").IsHitTestVisible=false}function toStackMode(){mode="stack";for(var a=1;a<=PHOTOCOUNT;a++){wpf.content.findname("slideToStack"+a).Begin();wpf.content.findname("photoCanvas"+a)["Canvas.ZIndex"]=0}wpf.content.findname("gridIcon").Opacity=1;wpf.content.findname("gridIcon").IsHitTestVisible=true;wpf.content.findname("stackIcon").Opacity=0;wpf.content.findname("stackIcon").IsHitTestVisible=false;wpf.content.findname("backArrow").Opacity=1;wpf.content.findname("backArrow").IsHitTestVisible=true;wpf.content.findname("forwardArrow").Opacity=1;wpf.content.findname("forwardArrow").IsHitTestVisible=true;photoStackTitle.Text=""}function ToolbarEnter(){wpf.content.findname("toolbarPanUp").Begin()}function ToolbarLeave(){wpf.content.findname("toolbarPanDown").Begin()}if(window.PhotoStackScriptLoaded)PhotoStackScriptLoaded()