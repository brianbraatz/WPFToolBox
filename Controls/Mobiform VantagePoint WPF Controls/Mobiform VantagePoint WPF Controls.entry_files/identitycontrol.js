var CNP_NAME_UNKNOWN="(no name)",CNP_STATUS_BLOCKED="Blocked",CNP_STATUS_BUSY="Busy",CNP_STATUS_BUSY_SENDTOOLTIP="(Busy) Click to send an instant message",CNP_STATUS_AWAY="Away",CNP_STATUS_AWAY_SENDTOOLTIP="(Away) Click to send an instant message",CNP_STATUS_BE_RIGHT_BACK="Be right back",CNP_STATUS_BE_RIGHT_BACK_SENDTOOLTIP="(Be right back) Click to send an instant message",CNP_STATUS_ON_THE_PHONE="In a call",CNP_STATUS_ON_THE_PHONE_SENDTOOLTIP="(In a call) Click to send an instant message",CNP_STATUS_OUT_TO_LUNCH="Out to lunch",CNP_STATUS_OUT_TO_LUNCH_SENDTOOLTIP="(Out to lunch) Click to send an instant message",CNP_STATUS_INVISIBLE="Appear offline",CNP_STATUS_ONLINE="Online",CNP_STATUS_ONLINE_SENDTOOLTIP="(Online) Click to send an instant message",CNP_STATUS_OFFLINE="Offline",CNP_STATUS_OFFLINE_SENDTOOLTIP="(Offline) Click to send an offline instant message",CNP_SET_LIVECONTACT="Receive contact updates",CNP_VIEW_SPACE="View space",CNP_VIEW_PROFILE="View profile",CNP_SEND_IM="Send instant message",CNP_ADD_TO_MYSOCIALNETWORK="Invite as friend",CNP_VIEW_SOCIAL_NETWORK="View friends list",CNP_INVITE_TO_MYBUDDYLIST="Invite as Messenger contact",CNP_CONFIRMATION_INVITE_TO_BUDDYLIST="An invitation to be a Messenger contact has been sent to {0}.",CNP_CONFIRMATION_ADD_TO_MY_SOCIALNETWORK="This person was added to your friends list and an invitation has been sent to {0}.",CNP_SN_TYPE_DISPLAY_NAME="Please type a first name for this contact:",CNP_GLEAM_ICON_TOOLTIP="See the new information",CNP_EP_VIEW_RECENT_ACTIVITY="View recent activity";registerNamespace("Live.Spaces.IdentityControl");var __IdCtrlNs=Live.Spaces.IdentityControl;__IdCtrlNs.ItemStatus=Web.Enum.create("None","Pending","Decrypting","Retrieved");registerNamespace("Live.Spaces.IdentityControl.Presence");__IdCtrlNs.Presence.State=Web.Flags.create("Offline",0,"Online",1,"Invisible",2,"Busy",3,"BeRightBack",4,"Idle",5,"Away",6,"OnThePhone",7,"OutToLunch",8);__IdCtrlNs.Presence.ConnectionState=Web.Flags.create("SignedIn",0,"SignedOut",1,"SigningIn",2,"SigningOut",3);__IdCtrlNs.Presence.BuddyListType=Web.Flags.create("ForwardList",1,"AllowList",2,"BlockList",4,"ReverseList",8,"PendingList",16);registerNamespace("ICSrv");ICSrv=new Web.Network.FppProxy("ICSrv");ICSrv.registerFppClass("AB",[Web.Network.FppProxy.__primitive("Flg"),Web.Network.FppProxy.__array("Cs"),Web.Network.FppProxy.__array("PpDIs"),Web.Network.FppProxy.__string("PMNe"),Web.Network.FppProxy.__object("Friends")]);ICSrv.CntType=Web.Flags.create("Reg",0,"Me",1,"L",2,"LD",3,"LP",4,"LR",5);ICSrv.registerFppClass("Cnt",[Web.Network.FppProxy.__string("Cid"),Web.Network.FppProxy.__string("PMN"),Web.Network.FppProxy.__string("Fn"),Web.Network.FppProxy.__string("Ln"),Web.Network.FppProxy.__primitive("IsMsgr"),Web.Network.FppProxy.__enum("CT")]);ICSrv.registerFppClass("MktCap",[Web.Network.FppProxy.__primitive("IsMessengerEnabled"),Web.Network.FppProxy.__primitive("IsLegacyMessengerEnabled")]);ICSrv.registerFppClass("ND",[Web.Network.FppProxy.__string("ST"),Web.Network.FppProxy.__string("FId"),Web.Network.FppProxy.__string("Rss"),Web.Network.FppProxy.__primitive("HA"),Web.Network.FppProxy.__date("LV"),Web.Network.FppProxy.__date("LC"),Web.Network.FppProxy.__primitive("G")]);ICSrv.registerFppClass("PpDI",[Web.Network.FppProxy.__string("Cid"),Web.Network.FppProxy.__primitive("HSA"),Web.Network.FppProxy.__date("SLC"),Web.Network.FppProxy.__date("SLV"),Web.Network.FppProxy.__primitive("SG"),Web.Network.FppProxy.__primitive("HPA"),Web.Network.FppProxy.__date("PLC"),Web.Network.FppProxy.__date("PLV"),Web.Network.FppProxy.__primitive("PG"),Web.Network.FppProxy.__primitive("HCPA"),Web.Network.FppProxy.__date("CPLC"),Web.Network.FppProxy.__date("CPLV"),Web.Network.FppProxy.__array("FS")]);ICSrv.registerFppClass("CidD",[Web.Network.FppProxy.__string("Cid"),Web.Network.FppProxy.__string("D")]);ICSrv.registerFppClass("AbNSet",[Web.Network.FppProxy.__custom(ICSrv.AB,"AB"),Web.Network.FppProxy.__custom(ICSrv.MktCap,"Set")]);ICSrv.FppStatus=Web.Flags.create("SUCCESS",0,"ERR_HTTP_MISCONFIGURATION",-7,"ERR_HTTP_PARSE_FAILURE",-6,"ERR_HTTP_CONNECT_FAILURE",-5,"ERR_HTTP_TIMEOUT",-4,"ERR_SERVER_UNCAUGHT",-3,"ERR_APP_SPECIFIC",-2,"ERR_FPP_PROTOCOL",-1);ICSrv.registerFppClass("FppError",[Web.Network.FppProxy.__string("ErrorCode"),Web.Network.FppProxy.__string("Message"),Web.Network.FppProxy.__object("ErrorObj"),Web.Network.FppProxy.__string("StackTrace")]);ICSrv.registerFppClass("FppReturnPackage",[Web.Network.FppProxy.__enum("Status"),Web.Network.FppProxy.__object("Value"),Web.Network.FppProxy.__oArray("OutRefParams"),Web.Network.FppProxy.__custom(ICSrv.FppError,"Error"),Web.Network.FppProxy.__object("ProfilingInfo")]);ICSrv.FppCommandType=Web.Flags.create("FPP",0,"FPP_JSON",1,"FPP_RP",2,"FPP_RP_JSON",3);ICSrv.FppVersion=Web.Flags.create("BASE",0,"ONE",1,"TWO",2,"CURRENT",2);ICSrv.registerFppClass("FppProxySettings",[Web.Network.FppProxy.__enum("Version"),Web.Network.FppProxy.__enum("CommandType"),Web.Network.FppProxy.__string("PartnerId"),Web.Network.FppProxy.__string("SessionId"),Web.Network.FppProxy.__string("AuthUser"),Web.Network.FppProxy.__string("ServerTunnelingUrl"),Web.Network.FppProxy.__primitive("UseClientXmlProxy"),Web.Network.FppProxy.__string("CanaryToken"),Web.Network.FppProxy.__primitive("DefaultRetry"),Web.Network.FppProxy.__primitive("Notify"),Web.Network.FppProxy.__enum("DateType")]);ICSrv.FppDateType=Web.Flags.create("Local",0,"UTC",1);ICSrv.registerFppMethod("getmarketcapability",[Web.Network.FppProxy.__string("market")],"getmarketcapability",Web.Network.Type.XMLGet,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");ICSrv.registerFppMethod("getaddressbook",[Web.Network.FppProxy.__string("market"),Web.Network.FppProxy.__string("cid"),Web.Network.FppProxy.__object("apiParams"),Web.Network.FppProxy.__string("cacheBuster")],"getaddressbook",Web.Network.Type.XMLGet,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");ICSrv.registerFppMethod("getaddressbookandsettings",[Web.Network.FppProxy.__string("market"),Web.Network.FppProxy.__string("cid"),Web.Network.FppProxy.__object("apiParams"),Web.Network.FppProxy.__string("cacheBuster")],"getaddressbookandsettings",Web.Network.Type.XMLGet,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");ICSrv.registerFppMethod("decryptpassportmembernames",[Web.Network.FppProxy.__string("encryptedData")],"decryptpassportmembernames",Web.Network.Type.XMLPost,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");ICSrv.registerFppMethod("addtosocialnetwork",[Web.Network.FppProxy.__string("contactCid"),Web.Network.FppProxy.__primitive("tryJoinContactsNetwork"),Web.Network.FppProxy.__primitive("addToBuddyList"),Web.Network.FppProxy.__string("firstName"),Web.Network.FppProxy.__string("lastName"),Web.Network.FppProxy.__string("displayName"),Web.Network.FppProxy.__string("market")],"addtosocialnetwork",Web.Network.Type.XMLPost,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");ICSrv.registerFppMethod("invitetomessenger",[Web.Network.FppProxy.__string("contactCid"),Web.Network.FppProxy.__string("market")],"invitetomessenger",Web.Network.Type.XMLPost,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");ICSrv.registerFppMethod("requestlivecontact",[Web.Network.FppProxy.__string("contactCid"),Web.Network.FppProxy.__string("market")],"requestlivecontact",Web.Network.Type.XMLPost,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");ICSrv.seal();registerNamespace("CardSvc");CardSvc=new Web.Network.FppProxy("CardSvc");CardSvc.IdType=Web.Flags.create("Contact",0);CardSvc.registerFppClass("Request",[Web.Network.FppProxy.__enum("IdType"),Web.Network.FppProxy.__string("Id"),Web.Network.FppProxy.__string("Partner"),Web.Network.FppProxy.__string("Market"),Web.Network.FppProxy.__custom(CardSvc.Stamps,"Timestamps")]);CardSvc.registerFppClass("Stamps",[Web.Network.FppProxy.__primitive("UpdateTimestamps"),Web.Network.FppProxy.__date("SLV"),Web.Network.FppProxy.__date("SLC"),Web.Network.FppProxy.__date("PLV"),Web.Network.FppProxy.__date("PLC"),Web.Network.FppProxy.__date("CPLV"),Web.Network.FppProxy.__date("CPLC"),Web.Network.FppProxy.__date("LCPLC"),Web.Network.FppProxy.__date("ELC"),Web.Network.FppProxy.__string("GM"),Web.Network.FppProxy.__array("Notifs")]);CardSvc.registerFppClass("Notif",[Web.Network.FppProxy.__string("ServiceType"),Web.Network.FppProxy.__string("ForeignId"),Web.Network.FppProxy.__string("RssUrl"),Web.Network.FppProxy.__date("LV"),Web.Network.FppProxy.__date("LC"),Web.Network.FppProxy.__primitive("Gleam")]);CardSvc.registerFppClass("Request2",[Web.Network.FppProxy.__enum("IdType"),Web.Network.FppProxy.__string("Id"),Web.Network.FppProxy.__string("Partner"),Web.Network.FppProxy.__string("Market"),Web.Network.FppProxy.__custom(CardSvc.Stamps,"Timestamps"),Web.Network.FppProxy.__primitive("OpenLinksInNewWindow")]);CardSvc.registerFppClass("FeedResponse",[Web.Network.FppProxy.__string("HeadHtml"),Web.Network.FppProxy.__string("BodyHtml"),Web.Network.FppProxy.__custom(CardSvc.Style,"Style"),Web.Network.FppProxy.__string("HeadHtml2"),Web.Network.FppProxy.__string("BodyHtml2"),Web.Network.FppProxy.__custom(CardSvc.Style2,"Style2")]);CardSvc.registerFppClass("Style",[Web.Network.FppProxy.__string("HTxtCl"),Web.Network.FppProxy.__string("HBgCl"),Web.Network.FppProxy.__string("HBgI"),Web.Network.FppProxy.__string("BTxtCl"),Web.Network.FppProxy.__string("BBgCl"),Web.Network.FppProxy.__string("BDivCl"),Web.Network.FppProxy.__string("ABgCl"),Web.Network.FppProxy.__string("ALkCl")]);CardSvc.registerFppClass("Style2",[Web.Network.FppProxy.__string("HeadText"),Web.Network.FppProxy.__string("HeadBkgd"),Web.Network.FppProxy.__string("BodyTitle"),Web.Network.FppProxy.__string("BodyPartTitle"),Web.Network.FppProxy.__string("BodyText"),Web.Network.FppProxy.__string("BodyBkgd"),Web.Network.FppProxy.__string("ActText"),Web.Network.FppProxy.__string("ActBkgd"),Web.Network.FppProxy.__string("DivClr")]);CardSvc.FppStatus=Web.Flags.create("SUCCESS",0,"ERR_HTTP_MISCONFIGURATION",-7,"ERR_HTTP_PARSE_FAILURE",-6,"ERR_HTTP_CONNECT_FAILURE",-5,"ERR_HTTP_TIMEOUT",-4,"ERR_SERVER_UNCAUGHT",-3,"ERR_APP_SPECIFIC",-2,"ERR_FPP_PROTOCOL",-1);CardSvc.registerFppClass("FppError",[Web.Network.FppProxy.__string("ErrorCode"),Web.Network.FppProxy.__string("Message"),Web.Network.FppProxy.__object("ErrorObj"),Web.Network.FppProxy.__string("StackTrace")]);CardSvc.registerFppClass("FppReturnPackage",[Web.Network.FppProxy.__enum("Status"),Web.Network.FppProxy.__object("Value"),Web.Network.FppProxy.__oArray("OutRefParams"),Web.Network.FppProxy.__custom(CardSvc.FppError,"Error"),Web.Network.FppProxy.__object("ProfilingInfo")]);CardSvc.FppCommandType=Web.Flags.create("FPP",0,"FPP_JSON",1,"FPP_RP",2,"FPP_RP_JSON",3);CardSvc.FppVersion=Web.Flags.create("BASE",0,"ONE",1,"TWO",2,"CURRENT",2);CardSvc.registerFppClass("FppProxySettings",[Web.Network.FppProxy.__enum("Version"),Web.Network.FppProxy.__enum("CommandType"),Web.Network.FppProxy.__string("PartnerId"),Web.Network.FppProxy.__string("SessionId"),Web.Network.FppProxy.__string("AuthUser"),Web.Network.FppProxy.__string("ServerTunnelingUrl"),Web.Network.FppProxy.__primitive("UseClientXmlProxy"),Web.Network.FppProxy.__string("CanaryToken"),Web.Network.FppProxy.__primitive("DefaultRetry"),Web.Network.FppProxy.__primitive("Notify"),Web.Network.FppProxy.__enum("DateType")]);CardSvc.FppDateType=Web.Flags.create("Local",0,"UTC",1);CardSvc.registerFppMethod("getcard",[Web.Network.FppProxy.__custom("request")],"getcard",Web.Network.Type.XMLPost,null,"MS.Msn.Spaces.Services.ContactCard.FireAnt.FeedFppService");CardSvc.registerFppMethod("getcard2",[Web.Network.FppProxy.__custom("request"),Web.Network.FppProxy.__primitive("version")],"getcard2",Web.Network.Type.XMLPost,null,"MS.Msn.Spaces.Services.ContactCard.FireAnt.FeedFppService");CardSvc.seal();__IdCtrlNs.Configs=new function(){var a=this,b;a.Partner;a.Market;a.ViewerId;a.ProxyFppUrl;a.MsgrEnabled;a.LgcyPpmMsgrEnabled;a.SpacesFD;a.IdentSvcHost;a.WLThemeUrl;a.SiteId;a.ReturnUrl;a.ReturnName;a.UxpLiveControlsBinding;a.UxpLiveStrings;a.CanaryCookieName;a.Load=function(){if(!b){var c;c=typeof __LiveIdentityControlConfig!="undefined"?__LiveIdentityControlConfig:null;a.Partner=c.PartnerId;a.Market=c.Market;a.ViewerId=new __IdCtrlNs.IdentityId(__IdCtrlNs.IdType.Contact,c.ViewerCid);a.ProxyFppUrl=c.ProxyFppUrl;a.SpacesFD=c.SpcFD;a.IdentSvcHost=c.IdentSvcHost;a.WLThemeUrl=c.WLThemeUrl;a.SiteId=c.SiteId;a.ReturnUrl=c.rurl;a.ReturnName=c.rname;a.UxpLiveControlsBinding=c.uxpLCB;a.UxpLiveStrings=c.uxpLS;a.GlobalNewWindow=c.globalNewWin==null?true:c.globalNewWin;a.CanaryCookieName=c.CanaryN;a.IdentityScriptBase=c.IdentScptBase;if(!a.WLThemeUrl.endsWith("/"))a.WLThemeUrl+="/";if(!a.SpacesFD.endsWith("/"))a.SpacesFD+="/"}};a.LoadFromServer=function(b){a.MsgrEnabled=b.IsMessengerEnabled;a.LegacyMsgrEnabled=b.IsLegacyMessengerEnabled};a.isSignedIn=function(){return a.ViewerId.GetId()!=0}};__IdCtrlNs.IdType=Web.Enum.create("Contact","Event","PartnerDefined");__IdCtrlNs.IdentityId=function(d,e){var a=this,b=d,c=e;a.IsId=function(a){return b==a.GetIdType()&&c==a.GetId()};a.GetIdType=function(){return b};a.GetId=function(){return c};a.toString=function(){return b.toString()+c};a.IsValidContact=function(){return b==__IdCtrlNs.IdType.Contact&&c!=0}};__IdCtrlNs.Utility=new function(){var a=this;a.FormatCidAsHex=function(c){var d="0123456789abcdef",h=0;if(c.charAt(0)=="-"){h=1;c=c.substr(1,c.length-1)}var a="";while(c!=""){var e="",f=0;for(var b=0;b<c.length;b+=1){var j=d.indexOf(c.charAt(b))+10*f,k=Math.floor(j/16);f=j%16;if(k!=0||e.length>0)e+=d.charAt(k)}c=e;a=d.charAt(f)+a}while(a.length<16)a="0"+a;if(h!=0){for(var b=a.length-1;b>=0;b--)a=a.substr(0,b)+d.charAt(15-d.indexOf(a.charAt(b)))+a.substr(b+1,a.length-b-1);var i=1;for(var b=a.length-1;b>=0;b--){var g=d.indexOf(a.charAt(b))+i;if(g>15)g-=16;else i=0;a=a.substr(0,b)+d.charAt(g)+a.substr(b+1,a.length-b-1)}}return a};a.IsIE7=function(){if(Web.Browser.isIE()&&navigator.userAgent){var b=navigator.userAgent.toLowerCase(),a=b.indexOf("msie"),c,d;if(a>=0){a+=4;if(a<b.length){c=b.indexOf(";",a+1);if(c<0)c=b.indexOf(")",a+1);if(c>=0){d=parseFloat(b.substring(a,c));return d&&d>=7}}}}return false};a.GetWLThemeImageUrl=function(b,a){return b.WLThemeUrl+"spacesidentityctrl/img/"+a};a.IsInMsgr=function(){return window&&window.external&&window.external.MsgrHost};a.OpenCardLinkElm=function(a){var c=true;if(a&&a.href){__IdCtrlNs.Utility.OpenLink(a.href,a.target=="_blank");c=false;var b=window.event;if(b){b.cancelBubble=true;b.returnValue=false}}return c};a.OpenLink=function(b,h,f,i,g){if(f){var c=__IdCtrlNs.DataMgrFactory.getInstance().getConfigs(),e=c.ReturnUrl?c.ReturnUrl:window.location.href,d=c.ReturnName;if(e){if(b.indexOf("?")>0)b+="&rurl=";else b+="?rurl=";b+=encodeURIComponent(e)}if(d){if(b.indexOf("?")>0)b+="&rname=";else b+="?rname=";b+=encodeURIComponent(d)}}if(h)return a.OpenWindow(b,null,i,g);else window.location=b};a.OpenWindow=function(c,e,d,f){if(a.IsInMsgr()){if(e==null){var g=__IdCtrlNs.DataMgrFactory.getInstance().getConfigs();e=g.SiteId}a.MsgrOpenWithAuth(c,e);return null}else{var b;if(f)b=window.open(c,d,f);else if(d)b=window.open(c,d);else b=window.open(c);if(b)try{b.focus()}catch(h){}return b}};a.MsgrOpenWithAuth=function(c,d){var b,a;a=window.external;if(a){b=a.MsgrHost;if(b)b.OpenWithAuth(c,Number(d))}};a.DateIsEarlier=function(c,a){var b=false;if(null==c)b=a&&a.getUTCFullYear()>2000;else b=a&&a.getUTCFullYear()>2000&&a<c;return b};a.GetPresenceImgInfo=function(g){var i=null,j=null;if(g.Properties.HasPresenceInfo()){var b=__IdCtrlNs.Presence.State;if(a.PresenceImgs==null){var e=a.GetWLThemeImageUrl,f=__IdCtrlNs.Configs,c=a.PresenceImgs={};c[b.Offline]=e(f,"MsgrOffline.gif");c[b.Online]=e(f,"MsgrOnline.gif");c[b.OnThePhone]=c[b.Busy]=e(f,"MsgrBusy.gif");c[b.BeRightBack]=c[b.Idle]=c[b.Away]=c[b.OutToLunch]=e(f,"MsgrAway.gif")}if(a.PresenceText==null){var d=a.PresenceText={};d[b.Offline]={t:CNP_STATUS_OFFLINE,a:CNP_STATUS_OFFLINE_SENDTOOLTIP};d[b.Online]={t:CNP_STATUS_ONLINE,a:CNP_STATUS_ONLINE_SENDTOOLTIP};d[b.OnThePhone]={t:CNP_STATUS_ON_THE_PHONE,a:CNP_STATUS_ON_THE_PHONE_SENDTOOLTIP};d[b.Busy]={t:CNP_STATUS_BUSY,a:CNP_STATUS_BUSY_SENDTOOLTIP};d[b.BeRightBack]={t:CNP_STATUS_BE_RIGHT_BACK,a:CNP_STATUS_BE_RIGHT_BACK_SENDTOOLTIP};d[b.Idle]=d[b.Away]={t:CNP_STATUS_AWAY,a:CNP_STATUS_AWAY_SENDTOOLTIP};d[b.OutToLunch]={t:CNP_STATUS_OUT_TO_LUNCH,a:CNP_STATUS_OUT_TO_LUNCH_SENDTOOLTIP}}if(g.IsBlocked()){i=a.GetWLThemeImageUrl("MsgrBlocked.gif");j=action=CNP_STATUS_BLOCKED}else{var h=g.Properties.Presence.Buddy.OnlineState;i=a.PresenceImgs[h];j=a.PresenceText[h].t;action=a.PresenceText[h].a}return {image:i,text:j,action:action}}return null};a.AddToMySocialNetwork=function(d){var f=__IdCtrlNs.DataMgrFactory.getInstance(),c=f.getConfigs(),e=window.location,j=e&&e.pathname&&e.pathname.toLowerCase().startsWith("/networkexplorer.aspx");if(c.isSignedIn()){var k=f.IdentMgr,h=k.GetMeContact();if(h&&h.HasSocialNetwork()){var b=d.getDisplayName();b=b!=null?b:CNP_NAME_UNKNOWN;if(b==CNP_NAME_UNKNOWN&&!a.IsIE7()){var g=window.prompt(CNP_SN_TYPE_DISPLAY_NAME,b);b=g?g:CNP_NAME_UNKNOWN}if(b&&b.trim().length>0){d.AddToMySocialNetwork("","",b);alert(CNP_CONFIRMATION_ADD_TO_MY_SOCIALNETWORK.format(b));return}}}var i=d.ContactId.GetId();a.OpenLink(c.SpacesFD+"spacesapi.aspx?wx_action=add&wx_url=%2ffriends.aspx&partner=social&size=small&cid="+i+"&mkt="+c.Market,j,false,"SN");f.IdentMgr.MarkAsFriendOrFan(i)};a.SubscribeContactUpdates=function(c){var d=__IdCtrlNs.DataMgrFactory.getInstance(),b=d.getConfigs();a.OpenLink(b.SpacesFD+"profile.aspx?action=makeactive&cid="+c.ContactId.GetId()+"&mkt="+b.Market,a.IsInMsgr(),true)};a.ShowMessengerInvitedDialog=function(a){alert(CNP_CONFIRMATION_INVITE_TO_BUDDYLIST.format(a?a:CNP_NAME_UNKNOWN))};a.CancelBubble=function(a){if(!a)a=window.event;a.cancelBubble=true;a.returnValue=false};a.CookieWrite=function(e,d,b,a,c){if(document.domain.endsWith(a))document.cookie=escape(e)+"="+escape(d)+(b?";expires="+b.toUTCString():"")+(c?";path="+c:"")+(a?";domain="+a:"")};a.CookieGetValue=function(f){var b=document.cookie,a,c=f+"=",e=b.indexOf(c);if(-1!=e){var d=b.indexOf(";",e+c.length);if(-1==d)d=b.length;a=b.substring(e+c.length,d);a=unescape(a)}return a};a.GetTimeFromNow=function(b){var a=new Date;a.setTime(a.getTime()+b*1000);return a};a.GetSharedDomain=function(a){var c=a.indexOf(":");if(c>0)a=a.substring(0,c);var b=a.split(".");if(b.length>=2)a=b[b.length-2]+"."+b[b.length-1];return a};a.decodeHtmlMarkup=function(a){return a}};var ICEPOpenLink=__IdCtrlNs.Utility.OpenCardLinkElm;__IdCtrlNs.IdentityProperties=function(d,b,c){var a=this;a.ABCH=d;a.MiniProfile=b;a.Presence=c;a.IsSetAsLiveContactPending=false;a.IsAddToMyBuddyListPending=false;a.IsAddToSocialNetworkPending=false;a.IsDynamicNoficationsResolved=false;a.HasABCHDynamicInfo=function(){return a.ABCH!=null&&a.ABCH.DI!=null};a.HasABCHDynamicInfoNotifications=function(){return a.HasABCHDynamicInfo()&&a.ABCH.DI.FS&&a.ABCH.DI.FS.length>0};a.HasABCHContactInfo=function(){return a.ABCH!=null&&a.ABCH.CI&&a.ABCH.CI.Cid!=null};a.HasDecryptedPMN=function(){var d=false;if(a.HasABCHContactInfo()){var b=a.ABCH.ContactInfo.ContactInformation;if(b){var c=b.PassportMemberNameIsEncrypted;d=b.PassportMemberName&&(typeof c=="undefined"||!c)}}return d};a.HasPresenceInfo=function(){return a.Presence!=null&&a.Presence.Buddy!=null};a.IsContactType=function(b){return a.HasABCHContactInfo()&&a.ABCH.CI.CT==b};a.IsMessengerUser=function(){return a.HasABCHContactInfo()&&a.ABCH.CI.IsMsgr};a.NotifyABCHDataUpdate=function(){a.OnABCHDataUpdate.fire(a)};a.OnABCHDataUpdate=Web.Event.create()};__IdCtrlNs.ABCHProperties=function(b,a){this.CI=b;this.DI=a};__IdCtrlNs.PresenceProperties=function(b){var a=this;a.Buddy=b;a.IsInBuddyListType=function(b){return (parseInt(a.Buddy.BuddyListType)&parseInt(b))>0}};__IdCtrlNs.IdentUpdateType=Web.Flags.create("None",0,"ABCH",1,"Presence",2,"Other",4);__IdCtrlNs.EventData=function(b,a){this.Source=b;this.Data=a};__IdCtrlNs_Contact=__IdCtrlNs.Contact=function(j){var a=this,b={};a.ContactId=j;a.dispose=function(){if(b.cardRequestTimer!=null){window.clearTimeout(b.cardRequestTimer);b.cardRequestTimer=null}a.Properties.OnABCHDataUpdate.detach(g);a=b=a.ContactId=null};a.IsInitialized=j==null;a.CapabilityStatus=__IdCtrlNs.ItemStatus.None;var i=false;a.IsGleaming=function(){var c=false;if(!i){var f=a.Properties;if(f.HasABCHDynamicInfo()){var b=f.ABCH.DI;c=b.GleamState?true:false;if(!c&&(h(b.SG,b.SLC,b.SLV)||h(b.PG,b.PLC,b.PLV)))c=true;if(!c&&(b.HCPA&&b.CPLC&&b.CPLV&&b.CPLC>b.CPLV))c=true;if(!c&&f.HasABCHDynamicInfoNotifications()){var e=b.FS;for(var d=0;d<e.length;++d)if(e[d]&&e[d].G){c=true;break}}}}return c};var h=function(a,b,c){if(a)if(typeof b!="undefined"&&typeof c!="undefined")a=b>c;return a};a.ClearGleam=function(){i=true;a.Properties.NotifyABCHDataUpdate();a.OnContactUpdate.fire(new __IdCtrlNs.EventData(a,__IdCtrlNs.IdentUpdateType.ABCH))};a.GetViewSpaceUrl=function(h){var b=Web.Utility.extractHost(c().SpacesFD,false);if(b.endsWith(":83")){var f=b.split(":",1);b=f[0]}var e=a.ContactId,d=0,g=e.GetIdType();if(g==__IdCtrlNs.IdType.Contact)d=e.GetId();if(d!=0)return "http://cid-"+__IdCtrlNs.Utility.FormatCidAsHex(d)+"."+b+h;return c().SpacesFD};a.IsMeContact=function(){return a.Properties.IsContactType(ICSrv.CntType.Me)||a.ContactId.IsId(__IdCtrlNs.DataMgrFactory.getInstance().getConfigs().ViewerId)};a.IsInMyLiveContact=function(){var b=a.Properties;return b.IsSetAsLiveContactPending||b.HasABCHContactInfo()&&b.ABCH.CI.CT!=ICSrv.CntType.Reg};a.IsInMySocialNetwork=function(){if(!a.ContactId.IsValidContact())return false;var b=__IdCtrlNs.DataMgrFactory.getInstance();return b.IdentMgr.IsFriendOrFan(a.ContactId.GetId())};a.IsInMyBuddyList=function(){var b=a.Properties;return b.IsAddToMyBuddyListPending||b.IsMessengerUser()};a.HasProfile=function(){var d=a.Properties,c=a.Properties.ABCH;return d.HasABCHDynamicInfo()&&(c.DI.PLC||c.DI.HPA)||b.profileName&&b.profileName.trim().length>0&&b.profileName!=CNP_NAME_UNKNOWN};a.HasSpace=function(){var b=a.Properties;return b.HasABCHDynamicInfo()&&(b.ABCH.DI.SLC||b.ABCH.DI.HSA)};a.HasSocialNetwork=function(){return a.HasSpace()};a.Properties=new __IdCtrlNs.IdentityProperties;a.ViewSocialNetwork=function(b){__IdCtrlNs.Utility.OpenLink(a.GetViewSpaceUrl("/friends"),!b,false)};a.ViewSpace=function(b){__IdCtrlNs.Utility.OpenLink(a.GetViewSpaceUrl(""),!b,false)};a.ViewRecentActivity=function(b){__IdCtrlNs.Utility.OpenLink(a.GetViewSpaceUrl("/recent/"),!b,false)};a.ViewProfile=function(a){__IdCtrlNs.Utility.OpenLink(c().SpacesFD+"profile.aspx?"+o(),!a,false)};a.AddFriend=function(){__IdCtrlNs.Utility.AddToMySocialNetwork(a)};a.AddToMySocialNetwork=function(g,h,f){var d=a.ContactId.GetId(),e=__IdCtrlNs.DataMgrFactory.getInstance();e.IdentSvc.addtosocialnetwork(d,true,false,g,h,f,c().Market,k);var b=a.Properties;b.IsAddToSocialNetworkPending=true;b.NotifyABCHDataUpdate();e.IdentMgr.MarkAsFriendOrFan(d)};a.AddToBuddyList=function(){var d=__IdCtrlNs.DataMgrFactory.getInstance();d.IdentSvc.invitetomessenger(a.ContactId.GetId(),c().Market,k);var b=a.Properties;b.IsAddToMyBuddyListPending=true;b.NotifyABCHDataUpdate();__IdCtrlNs.Utility.ShowMessengerInvitedDialog(a.getDisplayName())};a.SetAsLiveContact=function(){__IdCtrlNs.Utility.SubscribeContactUpdates(a);var b=a.Properties;b.IsSetAsLiveContactPending=true;b.NotifyABCHDataUpdate()};a.IsBlocked=function(){var b=a.Properties;if(b.HasPresenceInfo())return b.Presence.IsInBuddyListType(__IdCtrlNs.Presence.BuddyListType.BlockList);return false};a.SendIM=function(b){if(__IdCtrlNs.MsgrClient.IsEnabled(true))if(b)__IdCtrlNs.MsgrClient.SendIm(a,b);else __IdCtrlNs.MsgrClient.SendImNoMessage(a)};a.SetContactInfo=function(b,c){if(b!=null)a.SetProperties(b.ABCH,b.Presence);if(c!=null)a.CapabilityStatus=c};a.SetProperties=function(f,g,b){var e=__IdCtrlNs.IdentUpdateType.None,c=a.Properties;if(f!=null){if(a.IsMeContact()){c.ABCH=f;c.ABCH.CI.CT=ICSrv.CntType.Me}else c.ABCH=f;e|=__IdCtrlNs.IdentUpdateType.ABCH}if(g){c.Other=g;e|=__IdCtrlNs.IdentUpdateType.Other}if(b!=null){var d=c.Presence;if(null==d||d.Buddy.OnlineState!=b.Buddy.OnlineState||d.Buddy.BuddyListType!=b.Buddy.BuddyListType||d.Buddy.FriendlyName!=b.Buddy.FriendlyName||d.Buddy.PassportMemberName!=b.Buddy.PassportMemberName){c.Presence=b;e|=__IdCtrlNs.IdentUpdateType.Presence}}if(e!=__IdCtrlNs.IdentUpdateType.None)a.OnContactUpdate.fire(new __IdCtrlNs.EventData(a,e))};a.HasProperties=function(d,e,f){var b=true,c=a.Properties;if(d)b=b?c.HasABCHContactInfo():false;if(e)b=b?c.HasABCHDynamicInfo():false;if(f)b=b?c.HasPresenceInfo():false;return b};a.HasAnyProperties=function(){var b=a.Properties;return b&&(b.HasABCHContactInfo()||b.HasABCHDynamicInfo()||b.HasPresenceInfo())};a.Update=function(){if(b.mgr==null)b.mgr=__IdCtrlNs.DataMgrFactory.getInstance();var c=b.mgr.PresenceMgr;if(c&&c.IsInitialized()){var d=a.Properties;if(d.IsMessengerUser()||a.IsMeContact()){var e=c.GetPresencePropertiesForContact(a);if(__IdCtrlNs.MsgrClient.IsEnabled(true)){a.SetProperties(null,null,e);var f=a.IsMeContact()?__IdCtrlNs.MsgrClient.GetCurrentSignedInUserStatus():__IdCtrlNs.MsgrClient.GetUserStatus(a);if(f!=d.Presence.Buddy.OnlineState){d.Presence.Buddy.OnlineState=f;a.OnContactUpdate.fire(new __IdCtrlNs.EventData(a,__IdCtrlNs.IdentUpdateType.Presence))}}else a.SetProperties(null,null,e)}}else if(a.HasProperties(false,false,true)){a.Properties.Presence=null;a.OnContactUpdate.fire(new __IdCtrlNs.EventData(a,__IdCtrlNs.IdentUpdateType.Presence))}};var n=function(m){var i=CardSvc,l=__IdCtrlNs.Utility.DateIsEarlier,j=c();if(!j)return null;var d,f=new i.Request2;f.IdType=i.IdType.Contact;f.Id=a.ContactId.GetId();f.Partner=j.Partner;f.Market=j.Market;f.OpenLinksInNewWindow=m;if(a.HasProperties(false,true,false)){var b=a.Properties.ABCH.DI;f.Timestamps=d=new i.Stamps;d.UpdateTimestamps=a.IsGleaming();d.SLV=b.SLV;d.SLC=b.SLC;d.PLV=b.PLV;d.PLC=b.PLC;d.CPLC=b.CPLC;d.CPLV=b.CPLV;d.LCPLC=b.LCPLC;d.GM=b.GleamMask?b.GleamMask:0;var h=b.CPLC;if(l(h,b.SLC))h=b.SLC;if(l(h,b.PLC))h=b.PLC;d.elc=h;if(b.FS){d.Notifs=[];var n=b.FS.length;for(var k=0;k<n;++k){var g=b.FS[k],e=new i.Notif;e.ServiceType=g.ST;e.ForeignId=g.FId;e.RssUrl=g.Rss;e.LV=g.LV;e.LC=g.LC;e.Gleam=g.G;d.Notifs.push(e)}}}return f};a.requestCardBody=function(g,h,e){var a=false;if(b.cardInfo)if(b.cardInfo.timestamp==null||new Date-b.cardInfo.timestamp>15*60*1000){b.cardInfo.timestamp=null;a=true;b.cardRequestIssued=false}else return d();else a=true;if(a){var c={cb:g,context:h};if(b.cardRequestIssued){if(b.cardRequestQueue==null)b.cardRequestQueue=[];b.cardRequestQueue.push(c)}else f(false,c,e);return null}};var f=function(h,a,d){if(h){var c;b.cardRequestTimer=null;var g=__IdCtrlNs.DataMgrFactory.getInstance().getCardFppService();if(g){var f=n(d);if(f)g.getcard2(f,1,m,a,e);else c=true}else c=true;if(c)e({},a)}else{b.cardRequestIssued=true;b.cardRequestTimer=window.setTimeout(l(a,d),10)}},l=function(a,b){var c=function(){f(true,a,b);a=null};return c};a._setDisplayName=function(a){if(b.profileName==null)b.profileName=a};a.getDisplayName=function(){return b.profileName?b.profileName:null};var d=function(){return {id:a.ContactId,body:b.cardInfo.body,body2:b.cardInfo.body2,head:b.cardInfo.head,head2:b.cardInfo.head2,style:b.cardInfo.style,style2:b.cardInfo.style2}},m=function(e,c){if(e){if(b.cardInfo==null)b.cardInfo={};b.cardInfo.head2=e.HeadHtml2;b.cardInfo.body2=e.BodyHtml2;b.cardInfo.style2=e.Style2;b.cardInfo.timestamp=new Date;a.ClearGleam();if(c&&c.cb){var g=d();c.cb(g,c.context);if(b.cardRequestQueue){var f;while(b.cardRequestQueue.length>0){f=b.cardRequestQueue.pop();f.cb(g,f.context)}}}}},e=function(c,b){if(b&&b.cb)b.cb({id:a.ContactId,body:null,head:null,style:null},b.context)},c=function(){if(b.config==null)b.config=__IdCtrlNs.DataMgrFactory.getInstance().getConfigs();return b.config},o=function(){var b="",c=a.ContactId,d=c.GetIdType();if(d==__IdCtrlNs.IdType.Contact)b="cid="+c.GetId();return b},k=function(){},g=function(){a.OnABCHDataUpdate.fire(a)};a.Properties.OnABCHDataUpdate.attach(g);a.OnContactUpdate=Web.Event.create();a.OnContactInitialized=Web.Event.create();a.OnError=Web.Event.create();a.OnABCHDataUpdate=Web.Event.create();a.Update()};__IdCtrlNs.IdentityMgr=function(y,x){var e=y,a=this,b=[],c=x.Config;a.UrlUid={};a.ContactList=[];a.ContactListByCid={};a.ABContactsByCid={};a.AB=null;a.AddressBookStatus=__IdCtrlNs.ItemStatus.None;a.GetMeContact=function(){if(c&&b.meContact==null){var d=a.GetContact(c.ViewerId,true);if(d&&d.HasProperties(true,false,false)&&d.Properties.ABCH.CI&&d.Properties.ABCH.CI.CT==ICSrv.CntType.Me)b.meContact=d}return b.meContact};a.dispose=function(f){if(b.CreateFasterABLookupTimer){window.clearTimeout(b.CreateFasterABLookupTimer);b.CreateFasterABLookupTimer=null}if(b.ApplyABTimer){window.clearTimeout(b.ApplyABTimer);b.ApplyABTimer=null}if(b.DecryptedPMNInfoTimer){window.clearTimeout(b.DecryptedPMNInfoTimer);b.DecryptedPMNInfoTimer=null}var d=a.ABContactsByCid,e=d.length;for(var c=0;c<e;c++){d[c].OnABCHDataUpdate.detach(g);d[c].dispose(f)}b=a.ContactList=a.ContactListByCid=a.ABContactsByCid=a.AB=null;a.OnContactAdd.clear();a.OnLoadContactsComplete.clear();a.OnError.clear();a.OnAddressBookLoadComplete.clear();a=null};a.LoadContacts=function(b,a,c){h(b,a,c)};a.GetContact=function(b,d){var c;if(b&&b.GetIdType()==__IdCtrlNs.IdType.Contact&&b.GetId())c=a.ContactListByCid[b.GetId()];if(null!=c)return c;if(!d)return null;return u(b)};a.DecryptABInfo=function(c,d){var b=a.AB;if(b&&b.PMNe)e.IdentSvc.decryptpassportmembernames(b.PMNe,s,{cb:c,context:d},t,null,15000)};a.IsFriendOrFan=function(a){return b&&b.friends&&b.friends[a]==1};a.MarkAsFriendOrFan=function(c){if(!b.friends)b.friends={};b.friends[c]=1;a.NotifyExternalABChange()};var r=function(c){if(b.friends){var a,d=b.friends;for(a in d)if(d[a]==1)c[a]=1}b.friends=c},u=function(c){var b=new __IdCtrlNs.Contact(c,e);b.SetProperties(j(b));a.ContactList.push(b);if(c&&c.IsValidContact())a.ContactListByCid[c.GetId()]=b;return b};a.SendServerRequests=function(){if(a.AddressBookStatus==__IdCtrlNs.ItemStatus.None&&c&&c.ViewerId){var b=c.ViewerId.GetId();if(b!=0){a.AddressBookStatus=__IdCtrlNs.ItemStatus.Pending;e.IdentSvc.getaddressbookandsettings(c.Market,b,{},l(),v,null,null,15000)}}};var h=function(c,b,a){w(a,false)},j=function(d){var a=null,c=null,b=null;a=n(d.ContactId);if(a!=null&&(a.IsMsgr||a.CT==ICSrv.CntType.L||a.CT==ICSrv.CntType.Me))c=o(d.ContactId);if(a!=null)b=new __IdCtrlNs.ABCHProperties(a,c);return b},w=function(b,c){if(b!=null){a.AB=b;a.AB.ABContactsByCid={};r(a.AB.Friends);f(0);a.AddressBookStatus=__IdCtrlNs.ItemStatus.Retrieved}else if(c)a.AddressBookStatus=__IdCtrlNs.ItemStatus.Retrieved},s=function(a,c){b.DecryptedPMNInfo={data:a,cbContext:c};i(0)},t=function(){},p=function(a){var b=function(){i(a)};return b},i=function(h){b.UpdateWithDecryptPMNTimer=null;if(b.DecryptedPMNInfo==null||b.DecryptedPMNInfo.data==null)return;var j=new Date,f=b.DecryptedPMNInfo.data,e,c,i=a.ABContactsByCid,g=f.length;for(var d=h;d<g;++d){if(new Date-j>20){b.UpdateWithDecryptPMNTimer=window.setTimeout(p(d),300);return}c=f[d];if(c){e=i[c.Cid];if(e)e.PMN=c.D}}if(b.DecryptedPMNInfo.cbContext&&b.DecryptedPMNInfo.cbContext.cb)b.DecryptedPMNInfo.cbContext.cb(b.DecryptedPMNInfo.cbContext.context);b.DecryptedPMNInfo=null},z=function(){},m=function(a){var b=function(){f(a)};return b},f=function(d){b.CreateFasterABLookupTimer=null;var h=a.AB;if(h==null||h.Cs==null)return;var i=h.Cs,j=i.length,c,f=a.ABContactsByCid,d=d==null||d<1?0:d,l=new Date;for(var e=d;e<j;e++){if(new Date-l>50){b.CreateFasterABLookupTimer=window.setTimeout(m(e),250);return}c=i[e];if(c&&c.Cid){var g=c.Cid;if(f[g]==null||f[g].CT!=ICSrv.CntType.Me&&c.CT==ICSrv.CntType.Me)f[g]=c}}k(0)},q=function(a){var b=function(){k(a)};return b},k=function(d){b.ApplyABTimer=null;if(a.ABContactsByCid==null||a.AB==null)return;var d=d==null||d<1?0:d,k=new Date,c,f,h=a.ContactList,i=h.length;for(var e=d;e<i;e++){if(new Date-k>50){b.ApplyABTimer=window.setTimeout(q(e),200);return}c=h[e];if(c.Properties.ABCH==null&&!c.Properties.ABCHResolveAttempted){c.Properties.ABCHResolveAttempted=true;f=j(c);if(f!=null){c.SetProperties(f);c.OnABCHDataUpdate.attach(g)}}}a.OnAddressBookLoadComplete.fire(a)},v=function(a){if(a!=null){c.LoadFromServer(a.Set);h(null,false,a.AB)}},n=function(b){var c=a.AB;if(b==null||!b.IsValidContact()||c==null||c.Cs==null)return null;return a.ABContactsByCid[b.GetId()]},o=function(c){var e=a.AB;if(e==null||c==null||!c.IsValidContact()||e.PpDIs==null)return null;var d=e.PpDIs,f=d.length,g=c.GetId();for(var b=0;b<f;b++)if(d[b].Cid==g)return d[b];return null},g=function(){d()};a.NotifyExternalABChange=function(){d()};var l=function(c,e){var b=__IdCtrlNs.Utility.CookieGetValue("CCABUID");if(!b)if(e)b=1;else b=d(1);else b=parseInt(b);if(c)a.UrlUid.AbUidDataChanged=false;return b},d=function(d){var b;if(!a.UrlUid.AbUidDataChanged){if(d)b=d;else b=l(false,false);b+=1;var c=__IdCtrlNs.Utility;c.CookieWrite("CCABUID",b,c.GetTimeFromNow(15*60),c.GetSharedDomain(document.location.hostname),"/");a.UrlUid.AbUidDataChanged=true}return b};a.OnContactAdd=Web.Event.create();a.OnLoadContactsComplete=Web.Event.create();a.OnError=Web.Event.create();a.OnAddressBookLoadComplete=Web.Event.create()};__IdCtrlNs.IdentityMgr.skipClass=true;__IdCtrlNs.MsgrMode=Web.Enum.create("CID","PPM");__IdCtrlNs.MsgrClient=new function(){var a=this,b=__IdCtrlNs.Presence;a.SignedInUser=null;a.oMsgrClient=null;a.Version=null;a.Inited=false;a.m_mgr;a.m_configs;a.m_mode;a.m_disabled;var g=function(a){return a.MsgrEnabled&&a.isSignedIn()&&Web.Browser.isIE()},e=function(){if(a.Inited)return;a.Inited=true;a.m_mgr=__IdCtrlNs.DataMgrFactory.getInstance();a.m_configs=a.m_mgr.getConfigs();if(!g(a.m_configs))a.oMsgrClient=null;else try{a.oMsgrClient=new ActiveXObject("MSNMessenger.Hotmail2Control");j();k()}catch(b){a.oMsgrClient=null}},j=function(){var b=1792;if(a.oMsgrClient){var c=a.oMsgrClient.GetLocalUserStatus();a.oMsgrClient.SetLocalUserStatus(c);b=2048}a.Version=b};a.IsSupported=function(){e();if(a.oMsgrClient==null)return false;return true};a.IsEnabled=function(c){e();var b=a.oMsgrClient!=null&&!a.m_disabled;if(b&&c)b=i()&&a.IsOnlineContact(a.SignedInUser);return b};var i=function(){if(a.SignedInUser==null)if(a.m_mode==__IdCtrlNs.MsgrMode.CID){a.SignedInUser="cid:"+a.m_configs.ViewerId.GetId();return true}else{var b=a.m_mgr.IdentMgr.GetMeContact();if(b){a.SignedInUser=d(b);return true}}else return true;return false},k=function(){a.m_mode=__IdCtrlNs.MsgrMode.CID;if(!a.IsEnabled(true))if(a.m_configs.LegacyMsgrEnabled&&a.GetCurrentSignedInUserStatus()!=b.State.Offline){a.m_mode=__IdCtrlNs.MsgrMode.PPM;a.SignedInUser=null;a.m_disabled=true;a.m_mgr.IdentMgr.DecryptABInfo(h)}},h=function(){a.m_disabled=false},d=function(b){if(a.m_mode==__IdCtrlNs.MsgrMode.CID){if(b.ContactId.GetIdType()==__IdCtrlNs.IdType.Contact)return "cid:"+b.ContactId.GetId();return null}else if(a.m_mode==__IdCtrlNs.MsgrMode.PPM)if(b.HasProperties(true,false,false)){var c=b.Properties.ABCH.CI;if(c)return c.PMN}return null};a.IsOnlineContact=function(b){if(!a.IsSupported("IsOnlineContact"))return false;return a.oMsgrClient.IsUser(b)};a.AddContact=function(b){if(!a.IsSupported("AddContact"))return;a.oMsgrClient.AddContact(a.SignedInUser,b)};a.DeleteContact=function(b){if(!a.IsSupported("DeleteContact"))return;a.oMsgrClient.DeleteContact(a.SignedInUser,b)};a.BlockContact=function(){a.ShowContactList()};a.UnblockContact=function(){a.ShowContactList()};a.ShowContactList=function(){if(!a.IsSupported("ShowContactList"))return;a.oMsgrClient.ShowContactList()};a.GetCurrentSignedInUserStatus=function(){if(!a.IsSupported("GetCurrentSignedInUserStatus"))return b.State.Offline;var c=a.InternalStatusToStatus(a.oMsgrClient.GetLocalUserStatus());if(c==b.State.Offline)a.SignedInUser=null;return c};a.SetCurrentSignedInUserStatus=function(b){if(!a.IsSupported("SetCurrentSignedInUserStatus"))return;return a.oMsgrClient.SetLocalUserStatus(f(b))};a.SetCurrentSignedInUserDisplayName=function(){if(!a.IsSupported("SetCurrentSignedInUserDisplayName"))return;a.ShowContactList()};a.GetUserStatus=function(f){if(!a.IsSupported("GetUserStatus"))return b.State.Offline;try{var e=d(f),c;if(e){c=a.oMsgrClient.GetUserStatus(e);return a.InternalStatusToStatus(c)}}catch(g){}return b.State.Offline};a.GetBuddy=function(c){var e=d(c)!=a.SignedInUser?a.GetUserStatus(c):a.GetCurrentSignedInUserStatus();return new b.Buddy(c,b.BuddyListType.AllowList,e)};var c=[{IntStatus:1,stat:b.State.Offline},{IntStatus:2,stat:b.State.Online},{IntStatus:6,stat:b.State.Invisible},{IntStatus:10,stat:b.State.Busy},{IntStatus:14,stat:b.State.BeRightBack},{IntStatus:18,stat:b.State.Idle},{IntStatus:34,stat:b.State.Away},{IntStatus:50,stat:b.State.OnThePhone},{IntStatus:66,stat:b.State.OutToLunch}];a.InternalStatusToStatus=function(d){for(var a=0;a<c.length;++a)if(c[a].IntStatus==d)return c[a].stat;return b.State.Offline};var f=function(b){for(var a=0;a<c.length;++a)if(c[a].stat==b)return c[a].IntStatus;return 1};a.IsStateOnline=function(c){if(!a.IsSupported("IsStateOnline"))return false;return c!=b.State.Offline};a.SendIm=function(c,e){var b=d(c);if(!a.IsSupported("SendIm"))a.SendImNoMessage(b);else try{a.oMsgrClient.InstantMessage2(b,e,0)}catch(f){return}};a.SendImNoMessage=function(b){var c=d(b);if(!a.IsSupported("SendImNoMessage"))return;try{a.oMsgrClient.InstantMessage2(c,"",0)}catch(e){return}}};__IdCtrlNs.Presence.Buddy=function(c,b,d){var a=this;a.Contact=c;a.BuddyListType=b;a.OnlineState=d};__IdCtrlNs.PresenceMgr=function(k){var o=k,a=this,b=__IdCtrlNs.Presence;a.ConnectionState=b.ConnectionState.SignedOut;a.MeStatusCode=0;a.ContactList=null;var d=[],c=__IdCtrlNs.MsgrClient.IsEnabled;a.dispose=function(){if(d.UpdateAlContactsTimer){window.clearTimeout(d.UpdateAlContactsTimer);d.UpdateAlContactsTimer=null}a.OnSignInComplete.clear();a.OnSignOut.clear();a.OnConversationClosed.clear();a.OnConversationOpened.clear();a.OnUnreadEmailUpdate.clear();a.OnError.clear();k=a=o=a.ContactList=d=null};a.SignIn=function(c){var d=c!=null?c:b.State.Online;a.UpdateServerPollStatus(10000)};a.SignOut=function(){e(b.ConnectionState.SignedOut);if(c(false))__IdCtrlNs.MsgrClient.SignOut()};a.IsInitialized=function(){return this.ConnectionState==b.ConnectionState.SignedIn};a.GetPresencePropertiesForContact=function(a){var c=c=n(a,true),d=a.Properties;if(c!=null)return new __IdCtrlNs.PresenceProperties(c);else if(d.HasPresenceInfo()&&d.Presence.Buddy.OnlineState!=b.State.Offline)return new __IdCtrlNs.PresenceProperties(new b.Buddy(a,b.BuddyListType.AllowList,b.State.Offline));return null};var n=function(b){if(c(true))return __IdCtrlNs.MsgrClient.GetBuddy(b);if(a.ContactList==null||b.ContactId==null)return null;return null},i=new Date;a.UpdateServerPollStatus=function(a){i.setTime((new Date).getTime()+a)};a.SendServerRequests=function(){if(new Date>=i)if(c(false))l()};var h=true,g=true,l=function(){if(a.ConnectionState!=b.ConnectionState.SignedIn)if(c(true)){e(b.ConnectionState.SignedIn);g=true;h=true}else switch(__IdCtrlNs.MsgrClient.GetCurrentSignedInUserStatus()){case b.State.Offline:if(g){e(b.ConnectionState.SignedOut);g=false}break;default:if(h){e(b.ConnectionState.SignedOut);h=false}}else{if(!c(true))a.ConnectionState=b.ConnectionState.SignedOut;if(!f)j(0)}a.UpdateServerPollStatus(3000)},m=function(a){var b=function(){j(a)};return b},f=false,j=function(a){d.UpdateAlContactsTimer=null;f=true;var c=__IdCtrlNs.DataMgrFactory.getInstance().IdentMgr.ContactList;if(c!=null){var a=a==null||a<1?0:a,g=new Date,e=c.length;for(var b=a;b<e;b++){if(new Date-g>200){d.UpdateAlContactsTimer=window.setTimeout(m(b),200);return}c[b].Update()}}f=false},e=function(d,c){a.ConnectionState=d!=null?d:a.ConnectionState;a.MeStatusCode=c!=null?c:a.MeStatusCode;var b=__IdCtrlNs.DataMgrFactory.getInstance().IdentMgr.GetMeContact();if(b)b.OnContactUpdate.fire(new __IdCtrlNs.EventData(b,__IdCtrlNs.IdentUpdateType.Presence))};a.GetAvailableStates=function(){var e=c(false),d=[];switch(a.ConnectionState){case b.ConnectionState.SigningOut:case b.ConnectionState.SignedOut:d.push(b.State.Online);if(!e){d.push(b.State.Busy);d.push(b.State.BeRightBack);d.push(b.State.Away);d.push(b.State.OnThePhone);d.push(b.State.OutToLunch);d.push(b.State.Invisible)}break;case b.ConnectionState.SigningIn:case b.ConnectionState.SignedIn:d.push(b.State.Online);d.push(b.State.Busy);d.push(b.State.BeRightBack);d.push(b.State.Away);d.push(b.State.OnThePhone);d.push(b.State.OutToLunch);d.push(b.State.Invisible);d.push(b.State.Offline)}return d};a.OnSignInComplete=Web.Event.create();a.OnSignOut=Web.Event.create();a.OnConversationClosed=Web.Event.create();a.OnConversationOpened=Web.Event.create();a.OnUnreadEmailUpdate=Web.Event.create();a.OnError=Web.Event.create()};__IdCtrlNs.CtrlSize=Web.Enum.create("Undefined","ThumbnailNoName","Thumbnail1Line","Thumbnail2Line","Thumbnail3Line","ThreeLineView","OneTextLine","TextOnly");__IdCtrlNs.IdentityUI=function(d,b){__IdCtrlNs.IdentityUI.initializeBase(this,arguments);var c=this;b=this.getParameters();var G,a={},e,h=__IdCtrlNs.IdentityUI.lookups;c.initialize=function(b){F();__IdCtrlNs.IdentityUI.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,b);a.timer=window.setTimeout(y,1)};c.dispose=function(f){if(a.timer)window.clearTimeout(a.timer);if(a.tmrAttachEvtEP)window.clearTimeout(a.tmrAttachEvtEP);d.detachEvent("onclick",o);if(a.contact&&a.size!=__IdCtrlNs.CtrlSize.TextOnly)a.contact.OnContactUpdate.detach(j);__IdCtrlNs.IdentityUI.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,f);if(e)e.dispose();n();c=a=e=d=b=null};var n=function(){if(a.ep&&a.ep.hide&&typeof a.ep.hide=="function"){try{a.ep.hide()}catch(b){}if(a.epAttachEl)Web.Bindings.removeBindings(a.epAttachEl);a.ep=null}},F=function(){e=new Web.UI.Utilities.CleanupHelper;a.mgr=__IdCtrlNs.DataMgrFactory.getInstance();a.size=B(b.ids);a.id=E(b.idt,b.idv);a.epDelayMs=b.epd?b.epd:null;a.openDefaultActionsInNewWindow=b.odnw=="1"||b.odnw=="true";a.mgr.registerControl(a.id,c);a.tmrAttachEvtEP=window.setTimeout(r,100)},r=function(){a.tmrAttachEvtEP=null;d.onclick=null;d.attachEvent("onclick",o);g();if(a.id&&a.id.GetIdType()==__IdCtrlNs.IdType.Contact&&a.id.GetId()!="0"){var b=a.mgr.getConfigs();if(a.epAttachEl==null&&a.controlA)a.epAttachEl=a.controlA;if(a.epAttachEl&&!a.epDisabled)Web.Bindings.attachElementBinding(a.epAttachEl,"Live.Controls.EnhancedPreviewItem",null,{bodyTemplateType:"Live.Controls.BodyTemplate",headtemplatetype:"Live.Controls.HtmlHeadTemplate",attachtobody:$Browser.isIE()?"false":"true",actionlinksmaywrap:"false",displaytimeout:a.epDelayMs,minimumvisibleactioncount:5,maximumvisibleactioncountbeforehiding:6},null,C,["{framework.base}CoreUI.js",b.UxpLiveControlsBinding+"js/Live.Controls.EnhancedPreview.js",b.UxpLiveStrings+"strings.js"],["{theme.url}controls.css"],Web.Utility.Prioritizer.Priorities.Low,null,["{theme.url}controls/img/ep_beak_leftright_collage.gif","{theme.url}controls/img/ep_dots_collage.gif","{theme.url}controls/img/ep_loading_collage.gif","{theme.url}controls/img/ep_more_actions.gif","{theme.url}hig/img/glyph/close_rest_dark.gif"])}},C=function(b){a.ep=b;if(a&&a.inClickHandler)a.ep.hide()},B=function(c){var b=h.parseSize;if(b==null){var a=__IdCtrlNs.CtrlSize;b=h.parseSize={otl:a.OneTextLine,to:a.TextOnly,tlv:a.ThreeLineView,txs:a.Thumbnail1Line,ts:a.Thumbnail1Line,tm:a.Thumbnail1Line,tl:a.Thumbnail1Line,txl:a.Thumbnail1Line}}var d=b[c];return d},E=function(d,c){var b=h.parseId;if(b==null){var a=__IdCtrlNs.IdType;b=h.parseId={c:a.Contact,e:a.Event,p:a.PartnerDefined}}var e=b[d];return new __IdCtrlNs.IdentityId(e,c)},t=function(){if(a.customIconData==null){var d={},e=1,c;while(b["ci"+e+"j"]){c=new __IdCtrlNs.Icon(b,e++);if(c)d[c.IconNum]=c}a.customIconData=d}},q=function(){if(a.customActions==null){var d=[],e=1,c;while(b["ca"+e+"t"]){c=new __IdCtrlNs.Action(b,e++);if(c)d.push(c)}a.customActions=d}},g=function(){if(!a.foundEls){a.foundEls=true;var c=__IdCtrlNs.CtrlSize,b=a.size;if(b==c.Thumbnail1Line)u();else if(b==c.ThreeLineView)x();else if(b==c.OneTextLine)w();else if(b==c.TextOnly)v()}},i=function(){var c;c=d.getElementsByTagName("td");if(c&&c.length>=2){a.ciElem=c[1];a.ciAnchors=c[1].getElementsByTagName("a")}c=d.getElementsByTagName("div");if(c&&c.length>0){var i=0,h;for(var e=0;e<c.length&&i<=2;++e)if(c[e].className=="txt"){h=c[e].innerText;switch(i){case 0:a.profileName=h;f();break;case 1:a.customText1=h;break;case 2:a.customText2=h}++i}}if(!a.profileName)if(b.nm){a.profileName=__IdCtrlNs.Utility.decodeHtmlMarkup(b.nm);f()}var g;c=d.getElementsByTagName("img");if(c&&c.length>0)for(var e=0;e<c.length;++e)if(c[e].className=="IcPh"){g=a.photo=c[e];if(g.parentNode&&g.parentNode.tagName&&g.parentNode.tagName.toLowerCase()=="a")a.controlA=g.parentNode;break}},u=function(){i()},x=function(){i()},w=function(){var e,b,c;b=d.getElementsByTagName("div");if(b&&b.length>=1){b=b[0].getElementsByTagName("div");if(b&&b.length>=2){a.ciElem=b[0];a.ciAnchors=b[0].getElementsByTagName("a");c=b[1].getElementsByTagName("a");if(c==null||c.length==0)a.profileName=b[1].innerText;else{a.epAttachEl=a.controlA=c[0];a.profileName=c[0].innerText}f()}}},v=function(){var b=d.getElementsByTagName("a");if(b&&b.length>=1){a.controlA=a.epAttachEl=b[0];a.profileName=b[0].innerText;f()}},y=function(){a.timer=null;var b=a.contact=a.mgr.IdentMgr.GetContact(a.id,true);f();if(b&&a.size!=__IdCtrlNs.CtrlSize.TextOnly){b.OnContactUpdate.attach(j);if(b.HasAnyProperties(false,true,true))D()}},f=function(){if(a&&a.contact&&a.profileName)a.contact._setDisplayName(a.profileName)},D=function(){if(!a.gleamStateResolved){l();a.gleamStateResolved=true}if(!a.presenceStateResolved){m();a.presenceStateResolved=true}},j=function(a){var b=__IdCtrlNs.IdentUpdateType,c=false;if(a&&a.Data){if((a.Data&b.ABCH)>0)l();if((a.Data&b.Presence)>0)m()}},l=function(){g();var b=a.contact.IsGleaming();if(a.ciGleam==null&&b){var c=CNP_GLEAM_ICON_TOOLTIP;a.ciGleam=e.createNode("a",{href:"#",title:c},{});e.attachEvent("ui",a.ciGleam,"onclick",k);e.createNode("img",{className:"ci",src:__IdCtrlNs.Utility.GetWLThemeImageUrl(a.mgr.getConfigs(),"Gleam.gif"),alt:c},{},a.ciGleam);A(a.ciElem,a.ciGleam)}else if(a.ciGleam!=null&&!b){a.ciElem.removeChild(a.ciGleam);e.detachEvent(a.ciGleam,"onclick",k);a.ciGleam=null}},m=function(){g();var b=__IdCtrlNs.Utility.GetPresenceImgInfo(a.contact);if(!b)return;if(b&&a.ciPres==null){a.ciPres=e.createNode("a",{href:"#",title:b.action},{});e.attachEvent("ui",a.ciPres,"onclick",s);e.createNode("img",{className:"ci",src:b.image,alt:b.action},{},a.ciPres);z(a.ciElem,a.ciPres)}else if(b){a.ciPres.src=b.image;a.ciPres.alt=b.text}else{a.ciElem.removeChild(a.ciPres);a.ciPres=null}},z=function(a,c){var b=a.childNodes;if(b==null||b.length==0)a.appendChild(c);else a.insertBefore(c,b.item(0))},A=function(a,c){var b=a.childNodes;if(b==null||b.length<=1)a.appendChild(c);else a.insertBefore(c,b.item(1))},o=function(e){if(!a.inClickHandler&&(e==null||e.returnValue||typeof e.returnValue=="undefined")){var f=false,k=false,b=e.srcElement;while(b){if(a.controlA&&a.controlA==b){k=true;break}else if(b.className){if(b.className.indexOf("identctrl")>=0)break;if(b.className.indexOf("uxp_ep")>=0){f=true;return}}b=b.parentNode}if(a.ep)a.ep.hide();a.inClickHandler=true;g();t();var m=window.event,c=m.srcElement;if(!k){if(c&&a.customIconData){var h=c.getAttribute("ic:id"),i=0;if(c.childNodes)while(!h&&i<c.childNodes.length){if(c.childNodes[i].tagName=="IMG")h=c.childNodes[i].getAttribute("ic:id");i++}if(h){var l=a.customIconData[h];if(l){f=true;l.fire(a.contact,d)}}}}else{var j=p();if(j&&!j.isUrlAction()){f=true;j.fire(a.contact,d)}}if(f)__IdCtrlNs.Utility.CancelBubble(e);if(a)a.inClickHandler=false}},k=function(b){__IdCtrlNs.Utility.CancelBubble(b);if(a&&a.ep)a.ep.show()},s=function(b){__IdCtrlNs.Utility.CancelBubble(b);if(a&&a.contact)a.contact.SendIM()};c.getIdentity=function(){return a?a.contact:null};c.getIdentityId=function(){return a?a.id:null};c.getCustomActions=function(){q();return a.customActions};c.getCustomText=function(){var c=null,d=null;if(a){if(a.customText1)c=a.customText1;else if(b.ct1)c=a.customText1=b.ct1;if(a.customText2)d=a.customText2;else if(b.ct2)d=a.customText2=b.ct2}return [c,d]};var p=function(){var a=c.getCustomActions();if(a){var d=a.length;for(var b=0;b<d;++b)if(a[b]&&a[b].isDefaultAction())return a[b]}return null};c.getOpenDefaultActionsInNewWindow=function(){return a.openDefaultActionsInNewWindow};c._disableEP=function(){a.epDisabled=true;n()};c._disableEPItems=function(b){a.epHiddenMenuItemFlags=b};c._getDisabledEPItems=function(){return a&&a.epHiddenMenuItemFlags?a.epHiddenMenuItemFlags:0};c._getControlSize=function(){return a.size}};__IdCtrlNs.IdentityUI.registerClass("Live.Spaces.IdentityControl.IdentityUI","Web.Bindings.Base");__IdCtrlNs.IdentityUI.Params=Web.Enum.create("idt","idv","ids","odnw","nm","ct1","ct2","ci1j","ci1d","ci2j","ci2d","ca1t","ca1u","ca1un","ca1da","ca1j","ca1d","ca2t","ca2u","ca2un","ca2da","ca2j","ca2d","epd");__IdCtrlNs.IdentityUI.skipClass=true;__IdCtrlNs.IdentityUI.lookups={};__IdCtrlNs.DataMgrFactory=new function(){var a=this;a.getInstance=function(){var a=__IdCtrlNs.__DataManagerInstance;if(!a){a=Web.Bindings.attachElementBindingSync(document.body,"Live.Spaces.IdentityControl.DataMgr",null,{gblObject:__IdCtrlNs,gblPropName:"__DataManagerInstance"},null);if(__IdCtrlNs.__DataManagerInstance==null)__IdCtrlNs.__DataManagerInstance=a}return a}};__IdCtrlNs.DataMgr=function(l,c){__IdCtrlNs.DataMgr.initializeBase(this,arguments);var a=this;if(c.gblObject&&c.gblPropName)c.gblObject[c.gblPropName]=a;c=this.getParameters();var i,b={};b.controls={};b.controls.ByIdentId={};b.controls.ByElmId={};a.IdentSvc;a.IdentMgr;a.PresenceMgr;var d;a.initialize=function(a){j();__IdCtrlNs.DataMgr.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,a)};a.dispose=function(e){__IdCtrlNs.DataMgr.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,e);if(d){window.clearTimeout(d);d=null}if(a.IdentMgr){a.IdentMgr.OnAddressBookLoadComplete.detach(f);a.IdentMgr.dispose(e)}if(a.PresenceMgr)a.PresenceMgr.dispose(e);a=a.IdentSvc=a.PresenceMgr=b=l=c=null};var j=function(){if(!i){i=true;var c=b.config=__IdCtrlNs.Configs;c.Load();var e=new ICSrv.FppProxySettings;e.CanaryToken=c.CanaryCookieName;e.Version=ICSrv.FppVersion.ONE;e.PartnerId=c.Partner;e.SessionId=c.ViewerId.GetId();e.DefaultRetry=1;if(c.ProxyFppUrl)e.ServerTunnelingUrl=c.ProxyFppUrl;else e.UseClientXmlProxy=true;var j=g(c.IdentSvcHost,c);j="http://"+j+"/ContactControl/IdentityService.fpp";a.IdentSvc=ICSrv.initializeEx(j,e);a.IdentMgr=new __IdCtrlNs.IdentityMgr(a,{Config:c});a.IdentMgr.OnAddressBookLoadComplete.attach(f);d=window.setTimeout(h,0)}},g=function(a,c){a=Web.Utility.extractHost(a,false);if(!e(a,c)){var b=c.ViewerId.GetId();if(b!=0)a="cid-"+__IdCtrlNs.Utility.FormatCidAsHex(b)+"."+a}return a},e=function(a){a=Web.Utility.extractHost(a,false);var b={"cc.services.spaces.live.com":1,"cc.services.spaces-f1.live-int.com":1,"cc.services.spaces-f2.live-int.com":1,"cc.services.spaces-f3.live-int.com":1,"cc.services.spaces.live-int.com":1,"cc.services.spaces-dvl.live-int.com":1,"cc.services.spaces-bvt.live-int.com":1};return a.endsWith(":94")||b[a.toLowerCase()]!=1};a.getRollingUpgrade=function(){return e(b.config.IdentSvcHost,b.config)};a.getConfigs=function(){j();return b?b.config:null};var k=0;a.getCardFppService=function(){var e,a=b&&b.config?b.config:null;if(a){var c=new CardSvc.FppProxySettings;c.CanaryToken=a.CanaryCookieName;c.Version=CardSvc.FppVersion.ONE;c.PartnerId=a.Partner+"__"+(++k);c.SessionId=a.ViewerId.GetId();c.DefaultRetry=1;if(a.ProxyFppUrl)c.ServerTunnelingUrl=a.ProxyFppUrl;else c.UseClientXmlProxy=true;var d=g(a.IdentSvcHost,a);d="http://"+d+"/ContactCard/ContactCard.fpp";e=CardSvc.initializeEx(d,c)}return e};var h=function(){var c=a.IdentMgr;if(c!=null)c.SendServerRequests();if(a.PresenceMgr!=null)a.PresenceMgr.SendServerRequests();else if(b.ABLoaded){a.PresenceMgr=new __IdCtrlNs.PresenceMgr(this);a.PresenceMgr.SignIn()}d=window.setTimeout(h,1000)};a.registerControl=function(d,a){if(d&&a){b.controls.ByIdentId[d.toString()]=a;var c=a._element;if(c&&c.id)b.controls.ByElmId[c.id]=a}};a.getControlByElementId=function(a){return a?b.controls.ByElmId[a]:null};var f=function(){b.ABLoaded=true}};__IdCtrlNs.DataMgr.skipClass=true;__IdCtrlNs.DataMgr.registerClass("Live.Spaces.IdentityControl.DataMgr","Web.Bindings.Base");__IdCtrlNs.Icon=function(c,d){var b=this,a={};b.IconNum=d;var e=function(){var b="ci"+d;a.jsFncName=c[b+"j"];a.jsFncData=c[b+"d"]};e();b.dispose=function(){b=b.IconNum=c=a=null};b.fire=function(c,b){if(a.fcnObj==null)if(a.jsFncName)a.fcnObj=Function.parse(a.jsFncName);if(a.fcnObj)a.fcnObj(c,b,a.jsFncData)}};__IdCtrlNs.Action=function(c,d){var b=this,a={};b.ActionNum=d;var e=function(){var b="ca"+d;a.txt=c[b+"t"];a.url=c[b+"u"];a.useNewWin=c[b+"un"]=="1"?true:false;a.isDefault=c[b+"da"]?true:false;a.jsFncName=c[b+"j"];a.jsFncData=c[b+"d"]};e();b.dispose=function(){b=b.ActionNum=c=a=null};b.getText=function(){return a.txt};b.getUrl=function(){return a.url};b.getUseNewWindow=function(){return a.useNewWin};b.isDefaultAction=function(){return a.isDefault};b.getJSCallback=function(){return a.jsFncName};b.getJSCallbackData=function(){return a.jsFncData};b.isUrlAction=function(){return a.url?true:false};b.fire=function(c,b){if(a.fcnObj==null)if(a.jsFncName)a.fcnObj=Function.parse(a.jsFncName);if(a.fcnObj)a.fcnObj(c,b,a.jsFncData)}};__IdCtrlNs.TrackManager=function(c,e,d){var f=this,a={NameSpacePrefix:c,Market:e,LinkId:d};f.track=function(a){g(a)};function g(a){var d=b().format(a.ContentModule,a.ContentElement,a.HeadLine),c=new Image;c.src=d}function b(){if(!a.resolvedUrlFormat){var b=a.Market.toLowerCase().replace("-","_");a.resolvedUrlFormat="http://g.live.com/"+a.NameSpacePrefix+b+"/"+a.LinkId+"?cm={0}&ce={1}&hl={2}"}return a.resolvedUrlFormat}};__IdCtrlNs.TrackItem=function(c,b,d){var a=this;a.ContentModule=c;a.ContentElement=b;a.HeadLine=d};__IdCtrlNs.HideMenuItems=new $Flags("ViewFriends",1);__IdCtrlNs.EPDataProvider=function(){__IdCtrlNs.EPDataProvider.initializeBase(this,arguments);var C=this,a={};this.initialize=function(b){__IdCtrlNs.EPDataProvider.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,b);a.identMgr=__IdCtrlNs.DataMgrFactory.getInstance();a.configs=a.identMgr.getConfigs();this.registerFor("Live.Controls.EnhancedPreviewController",w)};this.dispose=function(b){__IdCtrlNs.EPDataProvider.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,b);if(a.styleTimer)window.clearTimeout(a.styleTimer);C=a=null};function w(a,b){if(b)a.attachEvent("onbeforeopen",i);else a.detachEvent("onbeforeopen",i)}function i(i){if(a.styleTimer){window.clearTimeout(a.styleTimer);a.styleTimer=null}var f=i.Package,d=f.template,c=f.srcElement,b;A();x();var h=0;while(c&&++h<7){if(c.className&&c.className.indexOf("identctrl")>=0){b=c.id;break}c=c.parentNode}if(!b)return;if(!(b.startsWith("ICc")||b.startsWith("ICe")||b.startsWith("ICp")))return;var e=a.identMgr.getControlByElementId(b);if(e){a.currentUI=e;a.currentIdentity=e.getIdentity();d.actions.clear();s(e,d.actions)}var g=d.head,j=d.body;g.title=g.subtitle=g.html=j.body="";a.invalidateActions=true;q(f)}var s=function(i,b){var e=a.currentIdentity;if(e==null||i==null)return;var f=a.configs.isSignedIn(),q,h,g;n();var o=__IdCtrlNs.HideMenuItems,p=i._getDisabledEPItems(),c=i.getCustomActions();h=c&&c.length>0;if(h){g=c[0].isDefaultAction();if(g)j(c,b)}var k=window.location,l=k&&k.pathname&&k.pathname.toLowerCase().startsWith("/networkexplorer.aspx");if(!l)d(a.contactActions.ViewSpace,b);if(h&&!g)j(c,b);if(!f||!e.IsInMySocialNetwork())d(a.contactActions.AddFriend,b);if(l)d(a.contactActions.ViewSpace,b);if((p&o.ViewFriends)==0)d(a.contactActions.ViewFriends,b);d(a.contactActions.ViewRecentActivity,b);if(!f||!e.IsInMyLiveContact())d(a.contactActions.SetAsLiveContact,b);var m=e.IsInMyBuddyList();if(f&&!m)d(a.contactActions.AddToBuddyList,b);if(f&&m&&e.HasProperties(false,false,true))d(a.contactActions.SendIM,b)},j=function(b,d){var c=Math.min(2,b.length);for(var a=0;a<c;++a)if(b[a])v(b[a],d)},v=function(a,b){if(a)b.add(a.getText(),"#",function(){r(a)})},r=function(b){t(b);if(b.isUrlAction())__IdCtrlNs.Utility.OpenLink(b.getUrl(),b.getUseNewWindow(),true);else if(a&&a.currentIdentity&&a.currentUI)b.fire(a.currentIdentity,a.currentUI);__IdCtrlNs.Utility.CancelBubble()},t=function(d){var b;if(d.ActionNum==1){if(!a.customActionTrack1)a.customActionTrack1=c("Custom action 1 (partner)","Cstm1");b=a.customActionTrack1}else{if(!a.customActionTrack2)a.customActionTrack2=c("Custom action 2 (partner)","Cstm2");b=a.customActionTrack2}k().track(b)},d=function(a,b){b.add(a.getText(),"#",a.getJSCallback())},n=function(){if(a.contactActions==null){var h={},d,b,g=a.contactAPIs;if(g==null)g=a.contactAPIs={};b=CNP_VIEW_SPACE;d=h.ViewSpace=new __IdCtrlNs.Action({cat:b,cada:1,caj:e},"");f(g,d,b,"ViewSpace",c("View Space","vwSpc"));b=CNP_VIEW_PROFILE;d=h.ViewRecentActivity=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"ViewRecentActivity",c("View recent activity","vwRAct"));b=CNP_VIEW_SOCIAL_NETWORK;d=h.ViewFriends=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"ViewSocialNetwork",c("View friends","vwFrnds"));b=CNP_INVITE_TO_MYBUDDYLIST;d=h.AddToBuddyList=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"AddToBuddyList",c("Invite to be a Messenger contact","invToMsngr"));b=CNP_ADD_TO_MYSOCIALNETWORK;d=h.AddFriend=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"AddFriend",c("Invite to be a friend","invFrnds"));b=CNP_SET_LIVECONTACT;d=h.SetAsLiveContact=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"SetAsLiveContact",c("Receive contact updates","getCntctUpdt"));b=CNP_SEND_IM;d=h.SendIM=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"SendIM",c("Send instant message","sndIMsg"));a.contactActions=h}},f=function(b,c,a,d,e){var f={id:a,action:c,api:d,trk:e};b[a]=f};function c(b,c){return new __IdCtrlNs.TrackItem(b,a.configs.Partner,c)}function k(){if(!a.trackMgr)a.trackMgr=new __IdCtrlNs.TrackManager("_0sa",a.configs.Market,"1000");return a.trackMgr}var e=function(b){__IdCtrlNs.Utility.CancelBubble();var f=a.currentIdentity,e;if(b&&b.srcElement&&b.srcElement.innerText)e=b.srcElement.innerText;var g=a.contactAPIs,c=g[e];if(c){k().track(c.trk);var d=f[c.api];if(d)d(!a.currentUI.getOpenDefaultActionsInNewWindow())}},q=function(b){var d=b.template.body;d.identityCardLoaded=false;var c,e={Package:b,RequestId:o()};if(a&&a.currentIdentity)c=a.currentIdentity.requestCardBody(h,e,a.currentUI.getOpenDefaultActionsInNewWindow());if(c)h(c,e);else{var f=b.template.head;f.title=f.html="";if(!d.identityCardLoaded)d.body='<div class="uxp_ep_loadingTemplate" onclick="window.event.returnValue=false;window.event.cancelBubble=true;"><span class="uxp_ep_loadingImageCollage">&nbsp;</span><div class="uxp_ep_loadingText">'+Live.Controls.Strings.LiveEnhancedPreviewStrings.Loading+"</div></div>";g(b.srcObject,["head","body"])}},h=function(b,c){var a=c.Package;if(b&&b.head2&&b.body2){if(!u(c.RequestId))return;var d=a.template.body;d.identityCardLoaded=true;a.template.head.html=y(b.head2);d.body=b.body2;g(a.srcObject,["head","body"]);l(a,b)}else{a.template.body.body='<div class="uxp_ep_loadErrorTemplate"><span class="uxp_ep_loadingImageCollage">&nbsp;</span><div class="uxp_ep_loadingText">'+Live.Controls.Strings.LiveEnhancedPreviewStrings.LoadError+"</div></div>";g(a.srcObject,["body"])}},y=function(b){var g="<!--icnonameS-->",h="<!--icnonameE-->",d=b.indexOf(g);if(d>0){var f=b.indexOf(h,d+g.length);if(f>0){var j=b.substring(d,f+h.length),i=a&&a.currentIdentity?a.currentIdentity.getDisplayName():null;if(i)b=b.replace(j,i.encodeHtml())}}var e=__IdCtrlNs.Utility.GetPresenceImgInfo(a.currentIdentity);if(e){var k='<img class="ci" alt="'+e.text.encodeHtml()+'" src="'+e.image.encodeHtmlAttribute()+'" />';b=b.replace("<!--icCI1-->",k)}var c=a.currentUI.getCustomText();if(c&&c.length>=2){if(c[0])b=b.replace("<!--icCL1-->",c[0].encodeHtml());if(c[1])b=b.replace("<!--icCL2-->",c[1].encodeHtml())}return b},l=function(h,e,f){if(h&&e)if(e.style2)z(e);else if(e.style){var n,c,b=e.style,d=B(h);if(d){var g=false,j=b.BDivCl?b.BDivCl:"";g=b.HBgI&&b.HBgI!="";if(d.outHead){c=d.outHead.style;c.color=b.HTxtCl?"#"+b.HTxtCl:"";c.backgroundColor=b.HBgCl?"#"+b.HBgCl:"";c.backgroundImage=g?"url("+b.HBgI+")":"none";c.backgroundRepeat="no-repeat"}if(d.outBody){c=d.outBody.style;c.color=b.BTxtCl?"#"+b.BTxtCl:"";c.backgroundColor=b.BBgCl?"#"+b.BBgCl:""}if(d.outActions){c=d.outActions.style;c.color=b.ALkCl?"#"+b.ALkCl:"";c.backgroundColor=b.ABgCl?"#"+b.ABgCl:""}if(d.areaHead){c=d.areaHead.style;c.backgroundColor="transparent";if(g)c.borderBottomStyle="none";else c.borderBottom="1px solid #"+j}if(d.areaBody){c=d.areaBody.style;c.backgroundColor="transparent";c.borderBottom="1px solid #"+j}if(d.areaActions){d.areaActions.style.backgroundColor="transparent";try{var k=d.areaActions.getElementsByTagName("A"),l=k.length,m=b.ALkCl?"#"+b.ALkCl:"";for(var i=0;i<l;i++)k[i].style.color=m}catch(o){}}}else if(f==null||f<=10)a.styleTimer=window.setTimeout(p(h,e,(f==null?0:f)+1),100)}},p=function(a,b,c){var d=function(){l(a,b,c);a=b=null};return d},B=function(f){var a=null;if(f){el=f.template.getElement("ep");if(null==el)return null;if(Web.Browser.isMozilla()&&el.parentNode){var g=el.parentNode.className;el.parentNode.className=g?g+" identctrl":"identctrl"}a={};var b=6,c,d=el.getElementsByTagName("div");if(d)for(var e=0;b>0&&e<d.length;++e){el=d[e];if(el){if(el.id){c=el.id;if(a.outHead==null&&c.endsWith("_head")){a.outHead=el;--b;continue}else if(a.outBody==null&&c.endsWith("_body")){a.outBody=el;--b;continue}else if(a.outActions==null&&c.endsWith("_actions")){a.outActions=el;--b;continue}}if(el.className){c=el.className;if(a.areaHead==null&&c=="efpHead"){a.areaHead=el;--b;continue}else if(a.areaBody==null&&c=="efpBody"){a.areaBody=el;--b;continue}else if(a.areaActions==null&&c=="efpActions"){a.areaActions=el;--b;continue}}}}if(b!=0)a=null}return a},z=function(h){if(h&&h.style2){var d=$Browser.isIE(),c=h.style2,e=d?{}:new $StringBuilder,i="color:",g=(d?(a&&a.currentUI&&a.currentUI._getControlSize()==__IdCtrlNs.CtrlSize.TextOnly?"span":"div")+".identctrl ":"")+"div.uxp_ep_ep ",f;f=g+"div.uxp_ep_head ";if(c.HeadText)b(e,d,c.HeadText,f+".IcTxt");if(c.HeadBkgd)b(e,d,c.HeadBkgd,f);f=g+"div.uxp_ep_body ";if(c.BodyTitle)b(e,d,c.BodyTitle,f+".IcTtl");if(c.BodyPartTitle)b(e,d,c.BodyPartTitle,f+".IcBpt");if(c.BodyText)b(e,d,c.BodyText,f+".IcBt");tmp="";if(c.BodyBkgd)tmp+=c.BodyBkgd;if(c.DivClr)tmp+=c.DivClr;if(tmp.length>0)b(e,d,tmp,f);f=g+"div.uxp_ep_actions ";if(c.ActBkgd)b(e,d,c.ActBkgd,f);if(c.ActText)b(e,d,c.ActText,f+"li a");if(!d){b(e,d,"padding:4px;","div.uxp_ep_ep a.uxp_ep_close");b(e,d,"width:20em;","div.uxp_ep_ep");b(e,d,"display:none;","div.uxp_ep_ep div.uxp_ep_sectionSeparator")}m(e)}},m=function(d){var b=a.elStyle;if(b==null)b=a.elStyle=document.getElementById("icStyle2");if(b)if(b.styleSheet){var f=b.parentNode;f.removeChild(b);var c=b.styleSheet;if(c.rules)while(c.rules.length>0)c.removeRule();for(var e in d)c.addRule(e,d[e]);f.appendChild(b)}else b.innerHTML=d.toString()},A=function(){m($Browser.isIE()?{}:"")},b=function(a,d,c,b){if(d)a[b]=c;else{a.append(b);a.append("{");a.append(c);a.append("} ")}};function x(){a.currentRequestId=++__IdCtrlNs.EPDataProvider.requestId;return a.currentRequestId}function u(b){return a.currentRequestId==b}function o(){return a.currentRequestId}var g=function(c,b){try{if(a.invalidateActions){b.push("actions");a.invalidateActions=false}c.invalidate(b)}catch(d){}}};__IdCtrlNs.EPDataProvider.skipClass=true;__IdCtrlNs.EPDataProvider.registerClass("__IdCtrlNs.EPDataProvider","Web.Bindings.Base");__IdCtrlNs.EPDataProvider.requestId=0;Web.Bindings.attachElementBinding(document.body,"Live.Spaces.IdentityControl.EPDataProvider",null,null,null,null,null,null,Web.Utility.Prioritizer.Priorities.Low,null,null)