<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Petzold Book Blog - Real-Time Drop-Shadow Slam-Dunk</title></head><body style="text-align: center;">
    <div style="width: 40em; text-align: left;"><p style="text-align: center;"><b><font size="+4">P</font><font size="+3">ETZOLD</font>&nbsp;<font size="+4">B</font><font size="+3">OOK</font>&nbsp;<font size="+4">B</font><font size="+3">LOG</font></b></p><h4 style="text-align: center;">Charles Petzold on writing books, reading books, and exercising the internal <a title="Universal Turing Machine">UTM</a></h4><hr><table width="100%"><tbody><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/blog.xml">Recent Entries</a></td><td width="33%"></td></tr><tr><td width="33%"><a href="http://www.charlespetzold.com/blog/2006/01/300654.html">&lt; Previous</a></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/toc.html">Browse the Archives</a></td><td align="right" width="33%"><a href="http://www.charlespetzold.com/blog/2006/02/020819.html">Next &gt;</a></td></tr><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/rss.xml">Subscribe to the RSS Feed</a></td><td width="33%"></td></tr></tbody></table><hr><a href="http://www.charlespetzold.com/blog/2006/02/011043.html" style="color: rgb(0, 0, 128); text-decoration: none;"><h2>Real-Time Drop-Shadow Slam-Dunk</h2></a><p style="text-align: right;">February 1, 2006<br>Nice day in New York</p><p>
In his book <i>Hackers</i>,
Steven Levy tells the story of MIT programmers who would continue to
shave instructions off a decimal-print routine until a guy named Jensen
took a whole different approach and completely nailed the problem. He
posted his solution on a bulletin board: "his way of telling them that
he had taken the decimal print routine to its limit. <i>Forty-six instructions.</i> People would stare at the code and their jaws would drop." (pg. 32)
</p>
<p>
That's pretty much how I felt when WinFX Tablet PC guy <a href="http://www.windojitsu.com/">Shawn Van Ness</a> sent me this little piece of XAML that does real-time drop-shadow on stylus (and mouse) input:
</p>
<ul style="font-family: monospace; font-weight: bold;">
&lt;Window&nbsp;xmlns="http://schemas.microsoft.com/winfx/avalon/2005"<br>&nbsp;&nbsp;&nbsp;&nbsp;Title="DropShadow&nbsp;Inking&nbsp;Test"&gt;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;Grid&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Background&nbsp;="Goldenrod"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Canvas&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name="dropshadowBackplane"&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RenderTransform="1,0,0,1,3,3"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Canvas.Background&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;VisualBrush&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Visual="{Binding&nbsp;ElementName=inkCanvas}"&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opacity="0.50"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Canvas.Background&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Canvas&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;InkCanvas&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;="inkCanvas"&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Background&nbsp;="Transparent"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Grid&nbsp;&gt;<br>&lt;/Window&gt;<br>
</ul>
<p>
Obviously he's taken a much different approach to real-time drop-shadow than in my <a href="http://www.charlespetzold.com/blog/2006/01/051134.html">bloated WPF program</a> or my <a href="http://www.charlespetzold.com/etc/RealTimeDropShadow/">dismal WinForms code</a>.
</p>
<p>
In Shawn's XAML, both the <i>Canvas</i> and <i>InkCanvas</i> elements are in the same cell in the <i>Grid</i> panel, which means they'll overlap, the <i>InkCanvas</i> on top. The purpose of the <i>InkCanvas</i> is to collect and render stylus (and mouse) input. But notice that transparent <i>Background</i> property, which means we'll also be seing the <i>Canvas</i> underneath. 
</p>
<p>
The <i>Canvas</i> colors its background with a <i>VisualBrush</i>, which is related to the <i>DrawingBrush</i> and <i>ImageBrush</i>. (All inherit from <i>TileBrush</i>.) But rather than using a drawing or bitmap for its surface, the <i>VisualBrush</i> uses a <i>Visual</i>, which is usually an element or a control. This particular <i>VisualBrush</i> binds its <i>Visual</i> property with the <i>InkCanvas</i>, which means it will display everything on the <i>InkCanvas</i>, but with an opacity of 50% and (due to the transform set on the <i>Canvas</i>) offset 3 units down and to the right.
</p>
<p>
The result is a drop-shadow. The rendering may not be real zippy, but the approach sure is elegant!
</p>
<p>
Here's a modified version of the program that renders stylus and mouse
input with a pen approximately a centimeter in width, and with the
shadow offset 1/4 of that width. (The <i>DrawingAttributes</i> class requires an explicit namespace mapping.)
</p>
<ul style="font-family: monospace; font-weight: bold;">
&lt;?Mapping&nbsp;XmlNamespace="ink"&nbsp;ClrNamespace="System.Windows.Ink"&nbsp;Assembly="PresentationCore"?&gt;<br>&lt;Window&nbsp;xmlns="http://schemas.microsoft.com/winfx/avalon/2005"<br>&nbsp;&nbsp;&nbsp;&nbsp;Title="DropShadow&nbsp;Inking&nbsp;Test&nbsp;2"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;Grid&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Background="Goldenrod"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Canvas&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name="dropshadowBackplane"&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RenderTransform="1,0,0,1,10,10"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Canvas.Background&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;VisualBrush&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Visual="{Binding&nbsp;ElementName=inkCanvas}"&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opacity="0.50"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Canvas.Background&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Canvas&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;InkCanvas&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name="inkCanvas"&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Background="Transparent"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;InkCanvas.DefaultDrawingAttributes&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ink:DrawingAttributes&nbsp;xmlns:ink="ink"&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Width="40"&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Height="40"/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/InkCanvas.DefaultDrawingAttributes&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/InkCanvas&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Grid&gt;&nbsp;<br>&lt;/Window&gt;<br>
</ul>
<div id="comments"><hr><table width="100%"><tbody><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/blog.xml">Recent Entries</a></td><td width="33%"></td></tr><tr><td width="33%"><a href="http://www.charlespetzold.com/blog/2006/01/300654.html">&lt; Previous</a></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/toc.html">Browse the Archives</a></td><td align="right" width="33%"><a href="http://www.charlespetzold.com/blog/2006/02/020819.html">Next &gt;</a></td></tr><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/rss.xml">Subscribe to the RSS Feed</a></td><td width="33%"></td></tr></tbody></table><hr><p>(c) Copyright Charles Petzold<br><a href="http://www.charlespetzold.com/">www.charlespetzold.com</a></p></div>
<a href="http://www.charlespetzold.com/">  </a></div></body></html>