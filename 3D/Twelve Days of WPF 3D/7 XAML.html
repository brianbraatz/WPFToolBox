<html><head><title>7: XAML</title>





<script type="text/javascript" src="7%20XAML_files/ericsinksoftware.js"> </script>
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://software.ericsink.com/rss.xml">
<style type="text/css">
.SiteTitle {font-family: Arial, Helvetica, sans-serif; font-size:36pt}
.Tagline {font-family: Arial, Helvetica, sans-serif}
.ArticleTitle {text-decoration: none; color: black; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:16pt}
.ArticleTitleGreen {text-decoration: none; color: #669900; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:16pt}
.DayPageArticleTitle {text-decoration: none; color: black; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:12pt}
.ArticleDate {color:black; font-family: Arial, Helvetica, sans-serif; font-size:7pt;font-weight:normal}
.LeftSide {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
.Copyright { font-family: Arial, Helvetica, sans-serif; font-size:7pt }
BLOCKQUOTE {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
P {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
OL {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
UL {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
LI {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
H2 {font-family:Arial,Helvetica,sans-serif}
H3 {font-family:Arial,Helvetica,sans-serif}
H4 {font-family:Arial,Helvetica,sans-serif}
H5 {font-family:Arial,Helvetica,sans-serif}
</style></head><body bgcolor="#000000">

<table align="center" bgcolor="#99cc33" border="0" cellpadding="0" cellspacing="0" width="870">
<tbody><tr><td colspan="3"><img src="7%20XAML_files/EricWeblogHeader1.jpg"></td></tr>
<tr>
<td colspan="3">&nbsp;</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td align="left" bgcolor="white"><img src="7%20XAML_files/corner_inside_upper_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="7%20XAML_files/corner_inside_upper_right.png"></td>
<td>&nbsp;</td>
<td align="left" bgcolor="white"><img src="7%20XAML_files/corner_inside_upper_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="7%20XAML_files/corner_inside_upper_right.png"></td>
</tr>
<tr>
<td bgcolor="white">&nbsp;</td>
<td bgcolor="white" valign="top" width="180">
<table border="0" cellpadding="0">
<tbody><tr><td class="LeftSide">
<a href="http://software.ericsink.com/index.html">Home</a><br>
<br>
<a href="http://software.ericsink.com/about_author.html">About Eric</a><br>
<br>
<a href="http://software.ericsink.com/rss.xml">RSS <img src="7%20XAML_files/xml.gif" border="0"></a><br>
<br>
<a href="http://software.ericsink.com/archive_index.html">Complete Archive</a><br>
<br>
<br>
<center><a href="http://www.amazon.com/exec/obidos/ASIN/1590596234/sawdust08-20"><img src="7%20XAML_files/ew-bos.png" border="0"></a></center>
<br>
<br>
<b>Series:</b><br>
<br>
<a href="http://software.ericsink.com/scm/source_control.html">Source Control HOWTO</a><br>
<br>
<a href="http://software.ericsink.com/Marketing_for_Geeks.html">Marketing for Geeks</a><br>
<br>
<a href="http://software.ericsink.com/laws/Immutable_Laws_Marketing.html">The 22 Immutable Laws of Marketing</a><br>
<br>
<a href="http://software.ericsink.com/bos/Business_of_Software.html">The Business of Software</a><br>
<br>
<a href="http://software.ericsink.com/wpf3d/index.html">WPF 3D</a><br>
<br>
<b>Topics:</b><br>
<br>
<a href="http://software.ericsink.com/tocs/Software_Development.html">Software Development</a><br>
<br>
<a href="http://software.ericsink.com/tocs/WPF.html">WPF</a><br>
<br>
<a href="http://software.ericsink.com/tocs/Business.html">Business</a><br>
<br>
<a href="http://software.ericsink.com/tocs/Laughs.html">Laughs</a><br>
<br>
<a href="http://software.ericsink.com/tocs/SourceGear_Products.html">SourceGear</a><br>
<br>
<br>
<b>Related Sites:</b><br>
<br>
<a href="http://notalegend.com/">www.NotALegend.com</a><br>
<br>
<a href="http://www.sourcegear.com/">www.SourceGear.com</a><br>
<br>
<a href="http://www.teamprise.com/">www.Teamprise.com</a><br>
<br>

</td></tr>
</tbody></table></td>
<td bgcolor="white">&nbsp;</td>
<td>&nbsp;</td>
<td bgcolor="white">&nbsp;</td>
<td bgcolor="white" valign="top" width="590">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr><td>

<p class="ArticleDate" align="right">Thursday, July 19, 2007</p>
<p class="ArticleTitle">7: XAML</p>

<p>This entry is part 7 of a <a href="http://software.ericsink.com/wpf3d/index.html">12-part series</a> on WPF
3D.</p>

<h3>Copying a WPF 3D Scene to the Clipboard as XAML</h3>

<p style="text-indent: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">Clipboard</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">.SetText(<span style="color: teal;">XamlWriter</span>.Save(myViewport3D));</span></p>

<p>The one-line solution above actually does work.&nbsp; But in my
situation, I had to do a bit more to get exactly what I wanted.&nbsp; I like to be
able to click the Copy button in Sawdust and then just Paste into <a href="http://www.charlespetzold.com/wpf/">XAML Cruncher</a>.&nbsp; Once again,
ScreenSpaceLines3D got in my way.</p>

<p>First of all, just as I did in the bitmap case in <a href="http://software.ericsink.com/wpf3d/3_Bitmap.html">part 3</a>, I prepare a
Viewport3D offscreen, give it a size, and then call Arrange(), Measure() and
UpdateLayout() to get it all ready to draw.&nbsp; Then I call every instance of
ScreenSpaceLines3D and tell them all to rescale.</p>

<p>The problem is that the XAML created by XamlWriter will have
&lt;ScreenSpaceLines3D&gt; tags.&nbsp; This is the correct thing for XamlWriter to
do, but it's not what I want.&nbsp; When I paste the result into XAML Cruncher, it
doesn't work because the ScreenSpaceLines3D class isn't available.&nbsp; I believe
XAML Cruncher has a way to load other DLLs for this kind of situation, but I
really just want my XAML to be more generic.</p>

<p style="">ScreenSpaceLines3D is a subclass
of ModelVisual3D.&nbsp; So it's really just a ModelVisual3D except that it has extra
methods to rebuild its geometry as needed.&nbsp; For the purpose of exporting to
XAML, I just want a ModelVisual3D which contains a snapshot of the geometry in
its current state.&nbsp; So, I do this:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">List</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">&lt;<span style="color: teal;">ScreenSpaceLines3D</span>&gt;
remove = <br>
&nbsp;&nbsp;&nbsp; <span style="color: blue;">new</span> <span style="color: teal;">List</span>&lt;<span style="color: teal;">ScreenSpaceLines3D</span>&gt;();<br>
<span style="color: teal;">List</span>&lt;<span style="color: teal;">ModelVisual3D</span>&gt;
add = <br>
&nbsp;&nbsp;&nbsp; <span style="color: blue;">new</span> <span style="color: teal;">List</span>&lt;<span style="color: teal;">ModelVisual3D</span>&gt;();<br>
<span style="color: blue;">foreach</span> (<span style="color: teal;">ModelVisual3D</span>
mv3d <span style="color: blue;">in</span> myViewport3D.Children)<br>
{<br>
&nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (mv3d <span style="color: blue;">is</span>
<span style="color: teal;">ScreenSpaceLines3D</span>)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">ScreenSpaceLines3D</span> ss = mv3d <span style="color: blue;">as</span> <span style="color: teal;">ScreenSpaceLines3D</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">ModelVisual3D</span> plain = <span style="color: blue;">new</span> <span style="color: teal;">ModelVisual3D</span>();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; plain.Content = ss.Content;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add.Add(plain);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; remove.Add(ss);<br>
&nbsp;&nbsp;&nbsp; }<br>
}<br>
<span style="color: blue;">foreach</span> (<span style="color: teal;">ModelVisual3D</span>
mv3d <span style="color: blue;">in</span> add)<br>
{<br>
&nbsp;&nbsp;&nbsp; myViewport3D.Children.Add(mv3d);<br>
}<br>
<span style="color: blue;">foreach</span> (<span style="color: teal;">ScreenSpaceLines3D</span>
ss <span style="color: blue;">in</span> remove)<br>
{<br>
&nbsp;&nbsp;&nbsp; myViewport3D.Children.Remove(ss);<br>
}</span></p>

<p>This gets me very close to what I want.&nbsp; I can take this
Viewport3D, generate the XAML and paste it into XAML Cruncher, and it mostly
works.&nbsp; I just want two more changes.</p>

<p>First, I want the XAML to be indented.&nbsp; The single argument
version of XamlWriter.Save() returns XAML in its most compact form, with no
indentation.&nbsp; So, instead, I have to use one of the other overloads to
XamlWriter.Save(), the one that writes to an XmlTextWriter, something like
this:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">StringBuilder</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> sb = <span style="color: blue;">new</span> <span style="color: teal;">StringBuilder</span>();<br>
<span style="color: teal;">TextWriter</span> tw = <span style="color: blue;">new</span>
<span style="color: teal;">StringWriter</span>(sb);<br>
<span style="color: teal;">XmlTextWriter</span> xw = <span style="color: blue;">new</span>
<span style="color: teal;">XmlTextWriter</span>(tw);<br>
xw.Formatting = <span style="color: teal;">Formatting</span>.Indented;<br>
<span style="color: teal;">XamlWriter</span>.Save(myViewport3D, xw);<br>
xw.Close();<br>
<span style="color: blue;">string</span> xaml = sb.ToString();</span></p>

<p>Finally, I really don't want the Viewport3D in the XAML
output to have a fixed size.&nbsp; Because I gave it a size and forced it through
the Arrange/Measure/UpdateLayout process, the resulting XAML includes the size
attributes on the Viewport3D tag.&nbsp; When I paste the whole thing into XAML
Cruncher, it honors the requested size whether it fits or not, but I want the
picture to automatically size to the available space.&nbsp; So...</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">xaml = xaml.Replace(<br>
&nbsp; <span style="color: blue;">string</span>.Format(<br>
&nbsp;&nbsp;&nbsp; <span style="color: maroon;">"&lt;Viewport3D Height=\"{0}\" Width=\"{1}\"
"</span>, <br>
&nbsp;&nbsp;&nbsp; myViewport.height, myViewport.width), <br>
&nbsp; <span style="color: maroon;">"&lt;Viewport3D "</span>);</span></p>

<p>If I wanted this to be a bit more robust, I might parse the
XAML and remove the two attributes using the XML APIs, but you get the idea.</p>

<p>The resulting XAML file containing a picture of the
workbench is <a href="http://software.ericsink.com/wpf3d/workbench.xaml">here</a>.</p>

<p></p><hr>
<a href="javascript:HaloScan('1691');" target="_self"><script type="text/javascript">postCount('1691');</script>Comment (1)</a><p>
</p>
</td></tr>
</tbody></table>
</td>
<td bgcolor="white">&nbsp;</td>
</tr>
<tr valign="bottom">
<td align="left" bgcolor="white"><img src="7%20XAML_files/corner_inside_lower_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="7%20XAML_files/corner_inside_lower_right.png"></td>
<td>&nbsp;</td>
<td align="left" bgcolor="white"><img src="7%20XAML_files/corner_inside_lower_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="7%20XAML_files/corner_inside_lower_right.png"></td>
</tr>
<tr><td colspan="7" class="Copyright">Copyright 2001-2007 Eric Sink. All Rights Reserved</td>
<td align="right">&nbsp;</td>
</tr>
</tbody></table>
</td>
<td>&nbsp;</td>
</tr>
<tr valign="bottom">
<td align="left"><img src="7%20XAML_files/corner_main_lower_left.png"></td>
<td>&nbsp;</td>
<td align="right"><img src="7%20XAML_files/corner_main_lower_right.png"></td>
</tr>
</tbody></table></body></html>