<html><head><title>2: Transparency</title>





<script type="text/javascript" src="2%20Transparency_files/ericsinksoftware.js"> </script>
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://software.ericsink.com/rss.xml">
<style type="text/css">
.SiteTitle {font-family: Arial, Helvetica, sans-serif; font-size:36pt}
.Tagline {font-family: Arial, Helvetica, sans-serif}
.ArticleTitle {text-decoration: none; color: black; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:16pt}
.ArticleTitleGreen {text-decoration: none; color: #669900; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:16pt}
.DayPageArticleTitle {text-decoration: none; color: black; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:12pt}
.ArticleDate {color:black; font-family: Arial, Helvetica, sans-serif; font-size:7pt;font-weight:normal}
.LeftSide {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
.Copyright { font-family: Arial, Helvetica, sans-serif; font-size:7pt }
BLOCKQUOTE {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
P {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
OL {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
UL {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
LI {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
H2 {font-family:Arial,Helvetica,sans-serif}
H3 {font-family:Arial,Helvetica,sans-serif}
H4 {font-family:Arial,Helvetica,sans-serif}
H5 {font-family:Arial,Helvetica,sans-serif}
</style></head><body bgcolor="#000000">

<table align="center" bgcolor="#99cc33" border="0" cellpadding="0" cellspacing="0" width="870">
<tbody><tr><td colspan="3"><img src="2%20Transparency_files/EricWeblogHeader1.jpg"></td></tr>
<tr>
<td colspan="3">&nbsp;</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td align="left" bgcolor="white"><img src="2%20Transparency_files/corner_inside_upper_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="2%20Transparency_files/corner_inside_upper_right.png"></td>
<td>&nbsp;</td>
<td align="left" bgcolor="white"><img src="2%20Transparency_files/corner_inside_upper_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="2%20Transparency_files/corner_inside_upper_right.png"></td>
</tr>
<tr>
<td bgcolor="white">&nbsp;</td>
<td bgcolor="white" valign="top" width="180">
<table border="0" cellpadding="0">
<tbody><tr><td class="LeftSide">
<a href="http://software.ericsink.com/index.html">Home</a><br>
<br>
<a href="http://software.ericsink.com/about_author.html">About Eric</a><br>
<br>
<a href="http://software.ericsink.com/rss.xml">RSS <img src="2%20Transparency_files/xml.gif" border="0"></a><br>
<br>
<a href="http://software.ericsink.com/archive_index.html">Complete Archive</a><br>
<br>
<br>
<center><a href="http://www.amazon.com/exec/obidos/ASIN/1590596234/sawdust08-20"><img src="2%20Transparency_files/ew-bos.png" border="0"></a></center>
<br>
<br>
<b>Series:</b><br>
<br>
<a href="http://software.ericsink.com/scm/source_control.html">Source Control HOWTO</a><br>
<br>
<a href="http://software.ericsink.com/Marketing_for_Geeks.html">Marketing for Geeks</a><br>
<br>
<a href="http://software.ericsink.com/laws/Immutable_Laws_Marketing.html">The 22 Immutable Laws of Marketing</a><br>
<br>
<a href="http://software.ericsink.com/bos/Business_of_Software.html">The Business of Software</a><br>
<br>
<a href="http://software.ericsink.com/wpf3d/index.html">WPF 3D</a><br>
<br>
<b>Topics:</b><br>
<br>
<a href="http://software.ericsink.com/tocs/Software_Development.html">Software Development</a><br>
<br>
<a href="http://software.ericsink.com/tocs/WPF.html">WPF</a><br>
<br>
<a href="http://software.ericsink.com/tocs/Business.html">Business</a><br>
<br>
<a href="http://software.ericsink.com/tocs/Laughs.html">Laughs</a><br>
<br>
<a href="http://software.ericsink.com/tocs/SourceGear_Products.html">SourceGear</a><br>
<br>
<br>
<b>Related Sites:</b><br>
<br>
<a href="http://notalegend.com/">www.NotALegend.com</a><br>
<br>
<a href="http://www.sourcegear.com/">www.SourceGear.com</a><br>
<br>
<a href="http://www.teamprise.com/">www.Teamprise.com</a><br>
<br>

</td></tr>
</tbody></table></td>
<td bgcolor="white">&nbsp;</td>
<td>&nbsp;</td>
<td bgcolor="white">&nbsp;</td>
<td bgcolor="white" valign="top" width="590">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr><td>

<p class="ArticleDate" align="right">Saturday, July 14, 2007</p>
<p class="ArticleTitle">2: Transparency</p>

<p>This entry is part 2 of a <a href="http://software.ericsink.com/wpf3d/index.html">12-part series</a> on WPF
3D.</p>

<h3>Transparency in WPF 3D</h3>

<p><img src="2%20Transparency_files/1686_image001.jpg" align="right" height="245" hspace="12" width="300">I love transparency in 3D graphics.&nbsp; For example, in this
picture of my workbench, I have made one foot transparent so it is easier to see
the <a href="http://en.wikipedia.org/wiki/Mortise_and_tenon">mortise and tenon
joint</a> used to attach the leg to the foot.</p>

<p>Unfortunately, transparency in WPF 3D doesn't work quite the
way I would have expected.</p>

<p>The drawing model for WPF 3D is called a "retained scene".&nbsp;
Basically, this means that you need to gather up all the triangles necessary to
draw your scene and stuff them into a data structure which is owned by WPF.&nbsp;
WPF will take responsibility for drawing the scene based on the information you
gave it.</p>

<p>This is actually quite nice.&nbsp; The alternative is a lot more
work.&nbsp; I started learning Windows programming in 1992.&nbsp; I still remember
feeling sort of cheated when I first realized that Windows wasn't going to draw
my objects for me.&nbsp; You mean just because somebody covered up my window and
then uncovered it, now I have to handle WM_PAINT if I want my stuff drawn back
the way it was?&nbsp; Why can't I just build a list of objects and let Windows
handle all the redraws whenever they're needed?&nbsp; I was young and
inexperienced.&nbsp; I eventually came to "get it".&nbsp; Nonetheless, fifteen years
later, WPF is giving me what I wanted.</p>

<p>And WPF does this very well.&nbsp; I can add all my triangles in
whatever order I want.&nbsp; WPF figures out which triangles are in front and which
ones are hidden.</p>

<p>However, in WPF 3D, the proper functioning of transparency
is dependent on the order in which the objects are drawn.&nbsp; This is a little disappointing.&nbsp;
Certainly I know how to cope with such things.&nbsp; I just don't want to.&nbsp; I'm spoiled.&nbsp;
I thought those days were behind me.</p>

<p>Luckily, the impact of this problem is minor.&nbsp; Basically,
when you are building the scene for your Viewport3D, add all the opaque objects
first.&nbsp; Then add all the transparent objects.</p>

<p>But this still leaves one problem:&nbsp; What happens if your app
has an interactive way to select an opaque object and make it transparent?&nbsp; For
example, suppose I select an object which happens to be the very first
GeometryModel3D in my scene.&nbsp; If I simply grab its brush and set the Opacity to
less than one, the object will turn transparent, but the objects behind it will
not show through as they should.&nbsp; WPF 3D wants transparent objects to be drawn <i>after</i>
opaque objects.</p>

<p>The solution to this problem is rather simple as well.&nbsp; Just
move it to the end.&nbsp; The code looks something like this:</p>

<p style=""><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: rgb(43, 145, 175);">DiffuseMaterial</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> mat = (<span style="color: rgb(43, 145, 175);">DiffuseMaterial</span>)myGeometryModel3D.Material;</span></p>

<p style=""><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: rgb(43, 145, 175);">SolidColorBrush</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> br = (<span style="color: rgb(43, 145, 175);">SolidColorBrush</span>)mat.Brush;</span></p>

<p style=""><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">br.Opacity = 0.3;</span></p>

<p style=""><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">myModel3DGroup.Children.Remove(myGeometryModel3D);</span></p>

<p style=""><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">myModel3DGroup.Children.Add(myGeometryModel3D);</span></p>

<p>Bottom line:&nbsp; I wish WPF 3D handled transparency without
caring about the ordering, but once you know how to deal with the problem, it's
not that big of a deal.</p>

<p></p><hr>
<a href="javascript:HaloScan('1686');" target="_self"><script type="text/javascript">postCount('1686');</script>Comments (5)</a><p>
</p>
</td></tr>
</tbody></table>
</td>
<td bgcolor="white">&nbsp;</td>
</tr>
<tr valign="bottom">
<td align="left" bgcolor="white"><img src="2%20Transparency_files/corner_inside_lower_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="2%20Transparency_files/corner_inside_lower_right.png"></td>
<td>&nbsp;</td>
<td align="left" bgcolor="white"><img src="2%20Transparency_files/corner_inside_lower_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="2%20Transparency_files/corner_inside_lower_right.png"></td>
</tr>
<tr><td colspan="7" class="Copyright">Copyright 2001-2007 Eric Sink. All Rights Reserved</td>
<td align="right">&nbsp;</td>
</tr>
</tbody></table>
</td>
<td>&nbsp;</td>
</tr>
<tr valign="bottom">
<td align="left"><img src="2%20Transparency_files/corner_main_lower_left.png"></td>
<td>&nbsp;</td>
<td align="right"><img src="2%20Transparency_files/corner_main_lower_right.png"></td>
</tr>
</tbody></table></body></html>