<html><head><title>11: Printing</title>





<script type="text/javascript" src="11%20Printing_files/ericsinksoftware.js"> </script>
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://software.ericsink.com/rss.xml">
<style type="text/css">
.SiteTitle {font-family: Arial, Helvetica, sans-serif; font-size:36pt}
.Tagline {font-family: Arial, Helvetica, sans-serif}
.ArticleTitle {text-decoration: none; color: black; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:16pt}
.ArticleTitleGreen {text-decoration: none; color: #669900; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:16pt}
.DayPageArticleTitle {text-decoration: none; color: black; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:12pt}
.ArticleDate {color:black; font-family: Arial, Helvetica, sans-serif; font-size:7pt;font-weight:normal}
.LeftSide {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
.Copyright { font-family: Arial, Helvetica, sans-serif; font-size:7pt }
BLOCKQUOTE {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
P {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
OL {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
UL {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
LI {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
H2 {font-family:Arial,Helvetica,sans-serif}
H3 {font-family:Arial,Helvetica,sans-serif}
H4 {font-family:Arial,Helvetica,sans-serif}
H5 {font-family:Arial,Helvetica,sans-serif}
</style></head><body bgcolor="#000000">

<table align="center" bgcolor="#99cc33" border="0" cellpadding="0" cellspacing="0" width="870">
<tbody><tr><td colspan="3"><img src="11%20Printing_files/EricWeblogHeader1.jpg"></td></tr>
<tr>
<td colspan="3">&nbsp;</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td align="left" bgcolor="white"><img src="11%20Printing_files/corner_inside_upper_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="11%20Printing_files/corner_inside_upper_right.png"></td>
<td>&nbsp;</td>
<td align="left" bgcolor="white"><img src="11%20Printing_files/corner_inside_upper_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="11%20Printing_files/corner_inside_upper_right.png"></td>
</tr>
<tr>
<td bgcolor="white">&nbsp;</td>
<td bgcolor="white" valign="top" width="180">
<table border="0" cellpadding="0">
<tbody><tr><td class="LeftSide">
<a href="http://software.ericsink.com/index.html">Home</a><br>
<br>
<a href="http://software.ericsink.com/about_author.html">About Eric</a><br>
<br>
<a href="http://software.ericsink.com/rss.xml">RSS <img src="11%20Printing_files/xml.gif" border="0"></a><br>
<br>
<a href="http://software.ericsink.com/archive_index.html">Complete Archive</a><br>
<br>
<br>
<center><a href="http://www.amazon.com/exec/obidos/ASIN/1590596234/sawdust08-20"><img src="11%20Printing_files/ew-bos.png" border="0"></a></center>
<br>
<br>
<b>Series:</b><br>
<br>
<a href="http://software.ericsink.com/scm/source_control.html">Source Control HOWTO</a><br>
<br>
<a href="http://software.ericsink.com/Marketing_for_Geeks.html">Marketing for Geeks</a><br>
<br>
<a href="http://software.ericsink.com/laws/Immutable_Laws_Marketing.html">The 22 Immutable Laws of Marketing</a><br>
<br>
<a href="http://software.ericsink.com/bos/Business_of_Software.html">The Business of Software</a><br>
<br>
<a href="http://software.ericsink.com/wpf3d/index.html">WPF 3D</a><br>
<br>
<b>Topics:</b><br>
<br>
<a href="http://software.ericsink.com/tocs/Software_Development.html">Software Development</a><br>
<br>
<a href="http://software.ericsink.com/tocs/WPF.html">WPF</a><br>
<br>
<a href="http://software.ericsink.com/tocs/Business.html">Business</a><br>
<br>
<a href="http://software.ericsink.com/tocs/Laughs.html">Laughs</a><br>
<br>
<a href="http://software.ericsink.com/tocs/SourceGear_Products.html">SourceGear</a><br>
<br>
<br>
<b>Related Sites:</b><br>
<br>
<a href="http://notalegend.com/">www.NotALegend.com</a><br>
<br>
<a href="http://www.sourcegear.com/">www.SourceGear.com</a><br>
<br>
<a href="http://www.teamprise.com/">www.Teamprise.com</a><br>
<br>

</td></tr>
</tbody></table></td>
<td bgcolor="white">&nbsp;</td>
<td>&nbsp;</td>
<td bgcolor="white">&nbsp;</td>
<td bgcolor="white" valign="top" width="590">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr><td>

<p class="ArticleDate" align="right">Monday, July 23, 2007</p>
<p class="ArticleTitle">11: Printing</p>

<p>This entry is part 11 of a <a href="http://software.ericsink.com/wpf3d/index.html">12-part series</a> on WPF
3D.</p>

<h3>Simple Printing</h3>

<p>I've said it before and I'll say it again now:&nbsp; It's just
incredibly cool that WPF's integration of 3D is so thorough that printing is supported.</p>

<p>Hardware accelerated 3D graphics APIs (like OpenGL and
Direct3D) are all about screens, not paper.&nbsp; If you're building a 3D graphics
app, these APIs are great.&nbsp; They not only make things a bit easier, but they offer
a big performance boost as well.&nbsp; But then if you want your app to be able to
print, the API disappears and you're left all alone.</p>

<p>In contrast, WPF makes this relatively simple.&nbsp; Printing a
Viewport3D in WPF looks like this:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">PrintDialog</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> dlg = <span style="color: blue;">new</span> <span style="color: teal;">PrintDialog</span>();<br>
<span style="color: blue;">if</span> ((<span style="color: blue;">bool</span>)dlg.ShowDialog().GetValueOrDefault())<br>
{<br>
&nbsp;&nbsp;&nbsp; dlg.PrintVisual(myViewport3D, <span style="color: maroon;">"Sawdust"</span>);<br>
}</span></p>

<p>Five lines.&nbsp; Were it not for my pathological need to use
braces on every if statement, it would be three lines.</p>

<h3>XPS</h3>

<p>As cool as it is to be able to print so easily, the code
above is rather simplistic.&nbsp; Most applications will want to offer their users
more.</p>

<p>My current printing code for Sawdust is focused on <a href="http://en.wikipedia.org/wiki/XML_Paper_Specification">XPS</a>, which is printer-friendly
document file format, conceptually similar to PDF.&nbsp; After constructing an XPS
file, I can spool it to the printer or save it to disk so the user may view,
print or archive it like a PDF file.&nbsp; More people use PDF, but for a WPF 3D
app, XPS is much easier to generate.&nbsp; Start by creating a FixedDocument.</p>

<h3>FixedDocument</h3>

<p>In the August 2007 issue of MSDN Magazine, <a href="http://www.markusegger.com/">Markus Egger</a> has a nice overview of
WPF's FlowDocument class.&nbsp; FlowDocument is designed for viewing
document-oriented content on a screen.&nbsp; Its sister class is FixedDocument,
which is designed for putting document-oriented content on paper.</p>

<p>As you might expect, a FixedDocument is simply a collection
of pages:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: blue;">public</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> <span style="color: blue;">static</span>
<span style="color: blue;">void</span> CreateFixedDocument()<br>
{<br>
&nbsp;&nbsp;&nbsp; <span style="color: teal;">FixedDocument</span> doc = <span style="color: blue;">new</span> <span style="color: teal;">FixedDocument</span>();<br>
&nbsp;&nbsp;&nbsp; doc.DocumentPaginator.PageSize = <span style="color: blue;">new</span> <span style="color: teal;">Size</span>(96 * 8.5, 96 * 11);<br>
<br>
&nbsp;&nbsp;&nbsp; <span style="color: blue;">foreach</span> (page that I want)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">PageContent</span> page = <span style="color: blue;">new</span> <span style="color: teal;">PageContent</span>();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">FixedPage</span> fixedPage =
CreateOneFixedPage();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ((<span style="color: teal;">IAddChild</span>)page).AddChild(fixedPage);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doc.Pages.Add(page);<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> doc;<br>
}</span></p>

<p>The IAddChild cast is rather funky.&nbsp; Microsoft's own sample
code shows this technique, but their documentation for IAddChild says: "This
member supports the Microsoft .NET Framework version 3.0 infrastructure and is
not intended to be used directly from your code."&nbsp; Hmmph.</p>

<p>The real work of creating aFixedDocument is in creating each
page.&nbsp; A FixedPage is a UIElement that acts somewhat like a Canvas.&nbsp; To layout
your page, you simply add a bunch of things to it, each with a specific size
and position.</p>

<p>First, create a FixedPage:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">FixedPage</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> page = <span style="color: blue;">new</span> <span style="color: teal;">FixedPage</span>();<br>
page.Background = <span style="color: teal;">Brushes</span>.White;<br>
page.Width = 96 * 8.5;<br>
page.Height = 96 * 11;</span></p>

<p>Now let's add a big title at the top of the page:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">TextBlock</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> tbTitle = <span style="color: blue;">new</span> <span style="color: teal;">TextBlock</span>();<br>
tbTitle.Text = <span style="color: maroon;">"My Page Title"</span>;<br>
tbTitle.FontSize = 24;<br>
tbTitle.FontFamily = <span style="color: blue;">new</span> <span style="color: teal;">FontFamily</span>(<span style="color: maroon;">"Arial"</span>);<br>
<span style="color: teal;">FixedPage</span>.SetLeft(tbTitle, 96 * 0.75); <span style="color: green;">// left margin<br>
</span><span style="color: teal;">FixedPage</span>.SetTop(tbTitle, 96 * 0.75); <span style="color: green;">// top margin<br>
</span>page.Children.Add((<span style="color: teal;">UIElement</span>)tbTitle);</span></p>

<p>Now we add our Viewport3D to the page.&nbsp; We want it to be 2
inches from the top of the sheet and 2 inches from the left side.&nbsp; We'll assume
we have already prepared a Viewport3D which is the proper size to fit.&nbsp; I think
I'll draw a thin black border around it as well.</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">Border</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> b = <span style="color: blue;">new</span> <span style="color: teal;">Border</span>();<br>
b.BorderThickness = <span style="color: blue;">new</span> <span style="color: teal;">Thickness</span>(1);<br>
b.BorderBrush = <span style="color: teal;">Brushes</span>.Black;<br>
b.Child = myViewport3D;<br>
<span style="color: teal;">FixedPage</span>.SetLeft(b, 96 * 2);<br>
<span style="color: teal;">FixedPage</span>.SetTop(b, 96 * 2);<br>
page.Children.Add((<span style="color: teal;">UIElement</span>)b);</span></p>

<p>Once you've constructed all the elements on your page, you
need to call Measure(), Arrange() and UpdateLayout() to get it ready for
drawing:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">Size</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> sz = <span style="color: blue;">new</span> <span style="color: teal;">Size</span>(96 * 8.5, 96
* 11);<br>
page.Measure(sz);<br>
page.Arrange(<span style="color: blue;">new</span> <span style="color: teal;">Rect</span>(<span style="color: blue;">new</span> <span style="color: teal;">Point</span>(), sz));<br>
page.UpdateLayout();</span></p>

<h3>From FixedDocument to XPS</h3>

<p>Once we have constructed a FixedDocument object in memory, what
do we do with it?&nbsp; Writing it out to an XPS file is pretty simple:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: teal;">FixedDocument</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> doc =
CreateFixedDocument();<br>
<span style="color: teal;">XpsDocument</span> xpsd = <span style="color: blue;">new</span>
<span style="color: teal;">XpsDocument</span>(filename, <span style="color: teal;">FileAccess</span>.ReadWrite);<br>
<span style="color: teal;">XpsDocumentWriter</span> xw = <span style="color: teal;">XpsDocument</span>.CreateXpsDocumentWriter(xpsd);<br>
xw.Write(doc);<br>
xpsd.Close();</span></p>

<h3>Viewing an XPS Document</h3>

<p>For viewing XPS files, I recommend you download the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=b8dcffdd-e3a5-44cc-8021-7649fd37ffee&amp;displaylang=en">XPS
Essentials Pack</a> from Microsoft.&nbsp; It contains a nice viewer application.</p>

<p>For WPF applications, XPS is the way to implement any
serious printing capabilities.&nbsp; I'm no expert with XPS yet, but so far I'm
quite pleased with the results I'm getting.</p>

<p></p><hr>
<a href="javascript:HaloScan('1696');" target="_self"><script type="text/javascript">postCount('1696');</script>Comment (1)</a><p>
</p>
</td></tr>
</tbody></table>
</td>
<td bgcolor="white">&nbsp;</td>
</tr>
<tr valign="bottom">
<td align="left" bgcolor="white"><img src="11%20Printing_files/corner_inside_lower_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="11%20Printing_files/corner_inside_lower_right.png"></td>
<td>&nbsp;</td>
<td align="left" bgcolor="white"><img src="11%20Printing_files/corner_inside_lower_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="11%20Printing_files/corner_inside_lower_right.png"></td>
</tr>
<tr><td colspan="7" class="Copyright">Copyright 2001-2007 Eric Sink. All Rights Reserved</td>
<td align="right">&nbsp;</td>
</tr>
</tbody></table>
</td>
<td>&nbsp;</td>
</tr>
<tr valign="bottom">
<td align="left"><img src="11%20Printing_files/corner_main_lower_left.png"></td>
<td>&nbsp;</td>
<td align="right"><img src="11%20Printing_files/corner_main_lower_right.png"></td>
</tr>
</tbody></table></body></html>