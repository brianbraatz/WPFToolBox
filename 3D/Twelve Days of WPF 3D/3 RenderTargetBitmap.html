<html><head><title>3: RenderTargetBitmap</title>





<script type="text/javascript" src="3%20RenderTargetBitmap_files/ericsinksoftware.js"> </script>
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://software.ericsink.com/rss.xml">
<style type="text/css">
.SiteTitle {font-family: Arial, Helvetica, sans-serif; font-size:36pt}
.Tagline {font-family: Arial, Helvetica, sans-serif}
.ArticleTitle {text-decoration: none; color: black; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:16pt}
.ArticleTitleGreen {text-decoration: none; color: #669900; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:16pt}
.DayPageArticleTitle {text-decoration: none; color: black; font-family: Arial, Helvetica, sans-serif; font-weight:bold; font-size:12pt}
.ArticleDate {color:black; font-family: Arial, Helvetica, sans-serif; font-size:7pt;font-weight:normal}
.LeftSide {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
.Copyright { font-family: Arial, Helvetica, sans-serif; font-size:7pt }
BLOCKQUOTE {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
P {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
OL {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
UL {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
LI {font-family: Arial, Helvetica, sans-serif; font-size:10pt}
H2 {font-family:Arial,Helvetica,sans-serif}
H3 {font-family:Arial,Helvetica,sans-serif}
H4 {font-family:Arial,Helvetica,sans-serif}
H5 {font-family:Arial,Helvetica,sans-serif}
</style></head><body bgcolor="#000000">

<table align="center" bgcolor="#99cc33" border="0" cellpadding="0" cellspacing="0" width="870">
<tbody><tr><td colspan="3"><img src="3%20RenderTargetBitmap_files/EricWeblogHeader1.jpg"></td></tr>
<tr>
<td colspan="3">&nbsp;</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td align="left" bgcolor="white"><img src="3%20RenderTargetBitmap_files/corner_inside_upper_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="3%20RenderTargetBitmap_files/corner_inside_upper_right.png"></td>
<td>&nbsp;</td>
<td align="left" bgcolor="white"><img src="3%20RenderTargetBitmap_files/corner_inside_upper_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="3%20RenderTargetBitmap_files/corner_inside_upper_right.png"></td>
</tr>
<tr>
<td bgcolor="white">&nbsp;</td>
<td bgcolor="white" valign="top" width="180">
<table border="0" cellpadding="0">
<tbody><tr><td class="LeftSide">
<a href="http://software.ericsink.com/index.html">Home</a><br>
<br>
<a href="http://software.ericsink.com/about_author.html">About Eric</a><br>
<br>
<a href="http://software.ericsink.com/rss.xml">RSS <img src="3%20RenderTargetBitmap_files/xml.gif" border="0"></a><br>
<br>
<a href="http://software.ericsink.com/archive_index.html">Complete Archive</a><br>
<br>
<br>
<center><a href="http://www.amazon.com/exec/obidos/ASIN/1590596234/sawdust08-20"><img src="3%20RenderTargetBitmap_files/ew-bos.png" border="0"></a></center>
<br>
<br>
<b>Series:</b><br>
<br>
<a href="http://software.ericsink.com/scm/source_control.html">Source Control HOWTO</a><br>
<br>
<a href="http://software.ericsink.com/Marketing_for_Geeks.html">Marketing for Geeks</a><br>
<br>
<a href="http://software.ericsink.com/laws/Immutable_Laws_Marketing.html">The 22 Immutable Laws of Marketing</a><br>
<br>
<a href="http://software.ericsink.com/bos/Business_of_Software.html">The Business of Software</a><br>
<br>
<a href="http://software.ericsink.com/wpf3d/index.html">WPF 3D</a><br>
<br>
<b>Topics:</b><br>
<br>
<a href="http://software.ericsink.com/tocs/Software_Development.html">Software Development</a><br>
<br>
<a href="http://software.ericsink.com/tocs/WPF.html">WPF</a><br>
<br>
<a href="http://software.ericsink.com/tocs/Business.html">Business</a><br>
<br>
<a href="http://software.ericsink.com/tocs/Laughs.html">Laughs</a><br>
<br>
<a href="http://software.ericsink.com/tocs/SourceGear_Products.html">SourceGear</a><br>
<br>
<br>
<b>Related Sites:</b><br>
<br>
<a href="http://notalegend.com/">www.NotALegend.com</a><br>
<br>
<a href="http://www.sourcegear.com/">www.SourceGear.com</a><br>
<br>
<a href="http://www.teamprise.com/">www.Teamprise.com</a><br>
<br>

</td></tr>
</tbody></table></td>
<td bgcolor="white">&nbsp;</td>
<td>&nbsp;</td>
<td bgcolor="white">&nbsp;</td>
<td bgcolor="white" valign="top" width="590">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr><td>

<p class="ArticleDate" align="right">Sunday, July 15, 2007</p>
<p class="ArticleTitle">3: RenderTargetBitmap</p>

<p>This entry is part 3 of a <a href="http://software.ericsink.com/wpf3d/index.html">12-part series</a> on WPF
3D.</p>

<h3>Saving a WPF 3D Scene to a Bitmap</h3>

<p>WPF has some really handy classes in it.&nbsp; Have you seen
RenderTargetBitmap?&nbsp; Basically, it's a simple way to capture a bitmap of any
WPF Visual.&nbsp; It works with 3D too:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: rgb(43, 145, 175);">RenderTargetBitmap</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> bmp = <span style="color: blue;">new</span> <span style="color: rgb(43, 145, 175);">RenderTargetBitmap</span>(<br>
width, height, 96, 96, <span style="color: rgb(43, 145, 175);">PixelFormats</span>.Pbgra32);</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">bmp.Render(myViewport3D);</span></p>

<p>Wanna copy that image to the clipboard so you can paste it
into some other application?</p>

<p style="text-indent: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: rgb(43, 145, 175);">Clipboard</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">.SetImage(bmp);</span></p>

<p>Wanna save that image to a PNG file?</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: rgb(43, 145, 175);">PngBitmapEncoder</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> png = <span style="color: blue;">new</span> <span style="color: rgb(43, 145, 175);">PngBitmapEncoder</span>();</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">png.Frames.Add(<span style="color: rgb(43, 145, 175);">BitmapFrame</span>.Create(bmp));</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: blue;">using</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> (<span style="color: rgb(43, 145, 175);">Stream</span>
stm = <span style="color: rgb(43, 145, 175);">File</span>.Create(filepath))</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">{</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">&nbsp;&nbsp;&nbsp; png.Save(stm);</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">}</span></p>

<p>Nifty.&nbsp; The pictures in this series of blog entries were
rendered in just this fashion.&nbsp; But there are a couple of details worth
mentioning.</p>

<p>When using RenderTargetBitmap, you should probably erase it
before you draw anything into it:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: rgb(43, 145, 175);">Rectangle</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> vRect = <span style="color: blue;">new</span> <span style="color: rgb(43, 145, 175);">Rectangle</span>();</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">vRect.Width = width;</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">vRect.Height = height;</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">vRect.Fill = <span style="color: rgb(43, 145, 175);">Brushes</span>.White;</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">vRect.Arrange(<span style="color: blue;">new</span> <span style="color: rgb(43, 145, 175);">Rect</span>(0, 0,
vRect.Width, vRect.Height));</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">bmp.Render(visual);</span></p>

<p>If your Viewport3D was created offscreen, it's not ready to
draw.&nbsp; You need to give it a size (the same as the bitmap you're rendering
into) and call Measure() and Arrange() to get it ready:</p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">myViewport3D.Width = width;</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">myViewport3D.Height =
height;</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">myViewport3D.Measure(<span style="color: blue;">new</span> <span style="color: rgb(43, 145, 175);">Size</span>(width,
height));</span></p>

<p style="margin-left: 0.5in;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">myViewport3D.Arrange(<span style="color: blue;">new</span> <span style="color: rgb(43, 145, 175);">Rect</span>(0, 0,
width, height));</span></p>

<p>Note that none of the above is specific to the 3D features
of WPF.&nbsp; RenderTargetBitmap just works with a Viewport3D like any other
visual.&nbsp; This is one of the best things about WPF:&nbsp; The 3D features are not
special or weird.&nbsp; They're seamlessly integrated into the framework.</p>

<p>If you have experience programming with some other 3D API
such as OpenGL or Direct3D (upon which WPF is built, by the way), you are
probably accustomed to thinking of 3D stuff as very distinct from other stuff.&nbsp;
Simple things like getting a 3D graphic to appear in the same window next to a
listbox can require all kinds of gymnastics.&nbsp; WPF doesn't have those sorts of
boundaries.&nbsp; If you want to put an animated 3D scene as the graphic for a
toolbar button, you can.</p>

<p>That level of integration is deeply neato.&nbsp; </p>

<p>Just one more detail about RenderTargetBitmap, and this one <i>is</i>
sort-of 3D-specific:</p>

<p>If your Viewport3D was created offscreen and you're using
our friend ScreenSpaceLines3D, you'll need to make sure your lines get scaled
at least once.&nbsp; Since I hacked my copy of ScreenSpaceLines3D.cs to remove the
use of CompositionTarget.Rendering, I simply call my Rescale() method on every
instance just after I call Measure() and Arrange() on the offscreen Viewport3D.</p>

<p></p><hr>
<a href="javascript:HaloScan('1687');" target="_self"><script type="text/javascript">postCount('1687');</script>Comments (2)</a><p>
</p>
</td></tr>
</tbody></table>
</td>
<td bgcolor="white">&nbsp;</td>
</tr>
<tr valign="bottom">
<td align="left" bgcolor="white"><img src="3%20RenderTargetBitmap_files/corner_inside_lower_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="3%20RenderTargetBitmap_files/corner_inside_lower_right.png"></td>
<td>&nbsp;</td>
<td align="left" bgcolor="white"><img src="3%20RenderTargetBitmap_files/corner_inside_lower_left.png"></td>
<td bgcolor="white">&nbsp;</td>
<td align="right" bgcolor="white"><img src="3%20RenderTargetBitmap_files/corner_inside_lower_right.png"></td>
</tr>
<tr><td colspan="7" class="Copyright">Copyright 2001-2007 Eric Sink. All Rights Reserved</td>
<td align="right">&nbsp;</td>
</tr>
</tbody></table>
</td>
<td>&nbsp;</td>
</tr>
<tr valign="bottom">
<td align="left"><img src="3%20RenderTargetBitmap_files/corner_main_lower_left.png"></td>
<td>&nbsp;</td>
<td align="right"><img src="3%20RenderTargetBitmap_files/corner_main_lower_right.png"></td>
</tr>
</tbody></table></body></html>