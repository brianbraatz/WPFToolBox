<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Petzold Book Blog - Hierarchical TreeView Templates</title></head><body style="text-align: center;">
    <div style="width: 40em; text-align: left;"><p style="text-align: center;"><b><font size="+4">P</font><font size="+3">ETZOLD</font>&nbsp;<font size="+4">B</font><font size="+3">OOK</font>&nbsp;<font size="+4">B</font><font size="+3">LOG</font></b></p><h4 style="text-align: center;">Charles Petzold on writing books, reading books, and exercising the internal <a title="Universal Turing Machine">UTM</a></h4><hr><table width="100%"><tbody><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/blog.xml">Recent Entries</a></td><td width="33%"></td></tr><tr><td width="33%"><a href="http://www.charlespetzold.com/blog/2006/02/130122.html">&lt; Previous</a></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/toc.html">Browse the Archives</a></td><td align="right" width="33%"><a href="http://www.charlespetzold.com/blog/2006/02/201111.html">Next &gt;</a></td></tr><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/rss.xml">Subscribe to the RSS Feed</a></td><td width="33%"></td></tr></tbody></table><hr><a href="http://www.charlespetzold.com/blog/2006/02/170442.html" style="color: rgb(0, 0, 128); text-decoration: none;"><h2>Hierarchical TreeView Templates</h2></a><p style="text-align: right;">February 17, 2006<br>New York City</p><p>
There's no question in my mind that templates are one of the most
powerful features in WPF. Although most template examples are in XAML,
I've been experimenting with defining templates in code. lt's often
weird, but I think I'm getting a better idea of what's going on behind
the scenes.
</p>
<p>
The <i>TreeView</i> control displays hierarchical data. You can fill up a <i>TreeView</i> control all at once or incrementally, as the data is required. Filling up a <i>TreeView</i> all at once often involves a recursive function. Filling up a <i>TreeView</i> incrementally (which is necessary if you're using it to display a disk directory tree, for example) requires handling the <i>Expanded</i> event of <i>TreeViewItem</i>.  With templates, however, it's possible to attach a class to the <i>TreeViewItem</i> that provides data for the <i>TreeView</i> as it's needed but without recursive functions or explicit event handling.
</p>
<p>
Here's a class I called <a href="http://www.charlespetzold.com/blog/2006/02/DiskDirectory.cs">DiskDirectory.cs</a>. It's really just a wrapper around the <i>DirectoryInfo</i> class and I would have derived this class from <i>DirectoryInfo</i> were it not sealed. The <i>DiskDirectory</i> class requires a <i>DirectoryInfo</i> as a argument to its constructor, and it maps its own <i>Name</i> property to the same-named property in <i>DirectoryInfo</i>. The bulk of the class is dedicated to implementing the <i>Subdirectories</i> property of type <i>List&lt;DiskDirectory&gt;</i>. This is basically the <i>GetDirectories</i> method of <i>DirectoryInfo</i> but translated into a property that returns a collection.
</p>
<p>
What we want is for the <i>TreeView</i> to display objects of type <i>DiskDirectory</i> and for the <i>ItemsSource</i> of each <i>TreeViewItem</i> (that is, the children of the item) to be set from the <i>Subdirectories</i> property of <i>DiskDirectory</i>. The <a href="http://www.charlespetzold.com/blog/2006/02/TemplateTheTree.cs">TemplateTheTree.cs</a> program shows how it's done. (This project also requires the <a href="http://www.charlespetzold.com/blog/2006/02/TemplateTheTree.csproj">TemplateTheTree.csproj</a> project file.)
</p>
<p>
The window constructor of this program creates an object of type <i>TreeView</i> and sets it as the window's content. It then creates an object of type <i>HierarchicalDataTemplate</i> based on the <i>DiskDirectory</i> object, and the <i>ItemsSource</i> of this template is bound to the <i>SubDirectories</i> property of <i>DiskDirectory</i>. The <i>VisualTree</i> property of the template could be more elaborate, but I made it a simple <i>TextBlock</i> whose <i>Text</i> property is bound to the <i>Name</i> property of <i>DiskDirectory</i>. The template is now completed. The window constructor continues by creating a single object of type <i>DiskDirectory</i> for the system drive. (In a real-life application, you'd probably create <i>DiskDirectory</i> objects for all the drives.) This <i>DiskDirectory</i> object is used to set the <i>Header</i> and <i>ItemsSource</i> properties of a <i>TreeViewItem</i>, which also has it's <i>ItemTemplate</i> set to the <i>HierarchicalDataTemplate</i> created earlier.
</p>
<p>
Put that <i>TreeViewItem</i> into the <i>TreeView</i> and you're done. Each <i>TreeViewItem</i> uses a <i>TextBlock</i> to display the <i>Name</i> property of its associated <i>DiskDirectory</i> object, and uses the <i>Subdirectories</i> property of <i>DiskDirectory</i> to generate its child <i>TreeViewItem</i> objects. No recursive functions, no event handling, and no moving parts.
</p>
<div id="comments"><hr><table width="100%"><tbody><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/blog.xml">Recent Entries</a></td><td width="33%"></td></tr><tr><td width="33%"><a href="http://www.charlespetzold.com/blog/2006/02/130122.html">&lt; Previous</a></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/blog/toc.html">Browse the Archives</a></td><td align="right" width="33%"><a href="http://www.charlespetzold.com/blog/2006/02/201111.html">Next &gt;</a></td></tr><tr><td width="33%"></td><td align="center" width="33%"><a href="http://www.charlespetzold.com/rss.xml">Subscribe to the RSS Feed</a></td><td width="33%"></td></tr></tbody></table><hr><p>(c) Copyright Charles Petzold<br><a href="http://www.charlespetzold.com/">www.charlespetzold.com</a></p></div>
<a href="http://www.charlespetzold.com/">  </a></div></body></html>